/*
 * Copyright (c) Orchestral Developments Ltd (2001 - 2014).
 *
 * This document is copyright. Except for the purpose of fair reviewing, no part
 * of this publication may be reproduced or transmitted in any form or by any
 * means, electronic or mechanical, including photocopying, recording, or any
 * information storage and retrieval system, without permission in writing from
 * the publisher. Infringers of copyright render themselves liable for
 * prosecution.
 */
YUI.add("yui2-orchestral-lightbox",function(e,t){
/*!(C) ORCHESTRAL*/
var n=e.YUI2,r=n.ORCHESTRAL;n.namespace("ORCHESTRAL.widget"),function(){var e=n.util.Event,t=n.util.Dom,i=n.lang,s=function(e,o){if(!t.get(e)){n.log("No element passed to Lightbox constructor","warn");return}this.viewportWidth=null,this.viewportHeight=null,this.initialZIndex=null,t.setStyle(e,"display","block"),o=i.merge({autofillheight:"body",draggable:!1,fixedcenter:n.env.ua.mobile?!1:"contained",naturalwidth:t.hasClass(e,"natural-content-width"),modal:!0,underlay:"shadow",visible:!1},o||{}),s.superclass.constructor.call(this,e,o),o=o||{},o.sidebar&&t.addClass(this.element,"lightbox-sidebar-enabled"),t[o.naturalwidth?"addClass":"removeClass"](e,"natural-content-width"),o.width&&t.removeClass(e,"natural-content-width"),(Math.floor(r.env.ua.gecko)===2||Math.floor(r.env.ua.gecko)===5||Math.floor(r.env.ua.gecko)===6)&&this.changeBodyEvent.subscribe(function(e){t.setStyle(this.body,"height","auto"),this.resize()}),t.setStyle(this.body,"height","auto"),o.visible||t.addClass(this.element,"cow-lightbox-hidden"),this.render(),this.resize(),n.env.ua.mobile?n.util.Event.on(window,"orientationchange",function(e){this.resize()},this,!0):(n.widget.Overlay.windowResizeEvent.subscribe(function(){if(this.viewportWidth===t.getViewportWidth()&&this.viewportHeight===t.getViewportHeight())return;this.resize()},null,this),n.widget.Overlay.windowScrollEvent.subscribe(this.resize,null,this)),this.beforeShowEvent.subscribe(function(){t.removeClass(this.element,"cow-lightbox-hidden")}),this.showEvent.subscribe(function(){t.setStyle(this.body,"height","auto"),this.resize()})};i.extend(s,n.widget.Dialog,{registerForm:function(){var n=this.element.getElementsByTagName("form")[0];if(this.form){if(this.form==n&&t.isAncestor(this.element,this.form))return;e.purgeElement(this.form),this.form=null}n&&(this.form=n,e.on(n,"submit",this._submitHandler,this,!0))},_onElementFocus:function(e){t.isAncestor("OrchestralCalendar",n.util.Event.getTarget(e))||s.superclass._onElementFocus.call(this,e)},bringToTop:function(){this.initialZIndex=this.cfg.getProperty("zindex"),s.superclass.bringToTop.apply(this,arguments),n.env.ua.mobile==="Apple"&&this.cfg.getProperty("zindex")==-1&&this.cfg.setProperty("zindex",2)},initEvents:function(){s.superclass.initEvents.apply(this,arguments),this.hideEvent.subscribe(function(e){t.addClass(this.element,"cow-lightbox-hidden"),this.cfg.setProperty("zindex",this.initialZIndex)})},initDefaultConfig:function(e){s.superclass.initDefaultConfig.call(this,e),this.cfg.addProperty("fillPageHeight",{value:!1,validator:i.isBoolean,handler:this.resize}),this.cfg.addProperty("sidebar",{writeOnce:!0,validator:function(e){return t.get(e)!==null},handler:function(e,r,s){var o=t.get(r[0]),u=null,a=function(){t.setStyle(o,"z-index",t.getStyle(this.element,"z-index")),t.setStyle(o,"height",this.innerElement.offsetHeight+"px"),t.setXY(o,[t.getX(this.innerElement)+this.innerElement.offsetWidth,t.getY(this.innerElement)])};this.beforeShowEvent.subscribe(function(){t.setStyle(o,"display","block"),t.setStyle(this.innerElement,"margin-right",o.offsetWidth+"px"),n.widget.Overlay.windowResizeEvent.subscribe(a,null,this),u=i.later(250,this,a,null,!0)}),this.showEvent.subscribe(a),this.beforeHideEvent.subscribe(function(){n.widget.Overlay.windowResizeEvent.unsubscribe(a),u.cancel(),t.setStyle(o,"display","none")})}})},configButtons:function(e,t,n){var r=t[0],o;for(o=0;i.isArray(r)&&o<r.length;o++)r[o].type=r[o].isDefault?"primary":"link";s.superclass.configButtons.apply(this,arguments)},configWidth:function(e,n,r){var i=this.innerElement,o=n[0];t.setStyle(i,"min-width",o),s.superclass.configWidth.apply(this,arguments)},resize:function(){var e=this.cfg.getProperty("fillPageHeight"),r=this.cfg.getProperty("visible");this.viewportWidth=t.getViewportWidth(),this.viewportHeight=t.getViewportHeight(),e||(t.setStyle([this.innerElement,this.body],"height","auto"),r&&this.fitsInViewport()&&this.center());if(e||this.element.offsetHeight>t.getViewportHeight()-30){var i=parseInt(t.getStyle(this.innerElement,"padding-top"))+parseInt(t.getStyle(this.innerElement,"padding-bottom"));this.cfg.setProperty("height",t.getViewportHeight()-30-i+"px"),this.cfg.setProperty("height",t.getViewportHeight()-30-i+"px"),r&&this.fitsInViewport()&&this.center()}this.sizeMask(),n.env.ua.ie===6&&this.sizeUnderlay()}}),r.widget.Lightbox=s}(),n.register("orchestral-lightbox",r.widget.Lightbox,{version:"7.9",build:"0"})},"7.9.0",{requires:["yui2-yahoo","yui2-orchestral","yui2-container"]});
