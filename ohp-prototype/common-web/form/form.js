/*
 * Copyright (c) Orchestral Developments Ltd (2001 - 2014).
 *
 * This document is copyright. Except for the purpose of fair reviewing, no part
 * of this publication may be reproduced or transmitted in any form or by any
 * means, electronic or mechanical, including photocopying, recording, or any
 * information storage and retrieval system, without permission in writing from
 * the publisher. Infringers of copyright render themselves liable for
 * prosecution.
 */
YAHOO.namespace("ORCHESTRAL.util"),ORCHESTRAL.util.Form=function(){var e=YAHOO.lang,t=YAHOO.util.Dom,n=YAHOO.util.Selector,r=function(e){return e.replace(/\r\n/g,"\r").replace(/\n/g,"\r")},i=function(t,n){return t=t||"",n=n||"",e.isArray(t)?t=t.join(","):e.isObject(t)&&(t=e.dump(t)),e.isArray(n)?n=n.join(","):e.isObject(n)&&(n=e.dump(n)),t==n},s=function(){return!0},o=function(e){var n=t.get(e),r=[];return r=r.concat(t.getElementsBy(s,"input",e)),r=r.concat(t.getElementsBy(s,"textarea",e)),r=r.concat(t.getElementsBy(s,"select",e)),r},u={input:function(e){var t=e.length?e[0].type:e.type;switch(t){case"checkbox":case"radio":return this.checkbox(e);default:return this.textarea(e)}},checkbox:function(e){var n=[];return t.batch(e,function(e){e.checked&&n.push(e.value?e.value:"on")}),this.returnArrayValue(n)},textarea:function(e){var n=[];return t.batch(e,function(e){(e.value||e.value==="")&&n.push(r(e.value))}),this.returnArrayValue(n)},select:function(e){var n=[];return t.batch(e,function(e){var t=e.options.length,r,i,s;for(r=0;r<t;r++)i=e.options[r],s=u.optionValue(i),i.selected&&s!==""&&n.push(s)}),this.returnArrayValue(n)},optionValue:function(e){return e.value?e.value:e.value===""?"":e.text},returnArrayValue:function(e){return e.length?e.length==1?e[0]:e:null}},a={input:function(e,t){var n=t.length?t[0].type:t.type;switch(n.toLowerCase()){case"checkbox":case"radio":this.checkbox(e,t);break;default:this.textarea(e,t)}},textarea:function(n,i){var s=e.isString(n.value)?[n.value]:n.value;t.batch(i,function(e){e.value=r(s.shift())})},checkbox:function(n,r){var i=e.isString(n.value)||e.isBoolean(n.value)?[n.value]:n.value;t.batch(r,function(e){!e.value||e.value=="on"?e.checked=ORCHESTRAL.lang.contains(!0,i)||ORCHESTRAL.lang.contains("on",i):e.checked=ORCHESTRAL.lang.contains(e.value,i)})},select:function(n,r){var i=e.isString(n.value)?[n.value]:n.value;t.batch(r,function(e){var t=e.options.length,n,r;for(n=0;n<t;n++)r=e.options[n],r.selected=ORCHESTRAL.lang.contains(u.optionValue(r),i)})}},f=function(e){return YAHOO.env.ua.ie>0?typeof e.length=="number"&&typeof e.item=="function"&&typeof e.nextNode=="function"&&typeof e.reset=="function":e instanceof NodeList};return{toQueryString:function(t){var n=[],r,i,s,o;for(r in t)if(t.hasOwnProperty(r)){i=t[r],e.isArray(i)||(i=[i]),o=i.length;for(s=0;s<o;s++)n.push(encodeURIComponent(r)+"="+encodeURIComponent(i[s]))}return n.join("&")},toParameters:function(t){var n=e.trim(t).match(/([^?#]*)(#.*)?$/);if(!n)return{};var r={},i=n[1].split("&"),s=i.length,o,u,a,f;for(o=0;o<s;o++)u=i[o].split("="),u[0]&&(a=decodeURIComponent(u[0]),f=u[1]?decodeURIComponent(u[1]):"",r[a]!==undefined?(e.isArray(r[a])||(r[a]=[r[a]]),f&&r[a].push(decodeURIComponent(f))):r[a]=decodeURIComponent(f));return r},fireEvents:function(e,n){t.batch(n,function(t){if(document.createEventObject)t.fireEvent("on"+e,document.createEventObject());else{var n=document.createEvent("HTMLEvents");n.initEvent(e,!0,!0),t.dispatchEvent(n)}})},activate:function(e){e=t.get(e),e.length&&(e=e[0]);try{e.focus(),e.select&&!n.test(e,"input[type=button], input[type=reset], input[type=submit]")&&e.select()}catch(r){}},disable:function(n){var r,i;n=t.get(n),e.isArray(n)||(n=[n]),i=n.length;for(r=0;r<i;r++)n[r].blur(),n[r].disabled=!0},enable:function(n){var r,i;n=t.get(n),e.isArray(n)||(n=[n]),i=n.length;for(r=0;r<i;r++)n[r].disabled=!1},getValue:function(e){var n;return e=t.get(e),n=e.tagName?e.tagName.toLowerCase():e[0].tagName.toLowerCase(),u[n](e)},setValue:function(e,n){e=t.get(e);var r={name:e.tagName?e.tagName.toLowerCase():e[0].tagName.toLowerCase(),value:n||""},s=ORCHESTRAL.util.Form.getValue(e);a[r.name](r,e);var o=ORCHESTRAL.util.Form.getValue(e);i(s,o)||this.fireEvents("change",e)},isEmpty:function(t){if(e.isArray(t)||f(t))throw new Error("isEmpty must be passed a single element");var n=e.trim(ORCHESTRAL.util.Form.getValue(t));return n===null||n===""},isEmptyScope:function(e){var t=o(e),n=t.length,r;for(r=0;r<n;r++)if(!this.isEmpty(t[r]))return!1;return!0},deserialize:function(e,t){var n=o(e),r,s,u,f,l,c;for(r in t)s={name:r,value:t[r]||""},u=ORCHESTRAL.lang.filter(n,function(e){return e.name==s.name}),u.length>0&&(f=u[0].tagName.toLowerCase(),l=ORCHESTRAL.util.Form.getValue(u),a[f](s,u),c=ORCHESTRAL.util.Form.getValue(u),i(l,c)||this.fireEvents("change",u))},serialize:function(n){var r=o(n),i={};return t.batch(r,function(n){if(!n.disabled&&n.name){var r=n.name;n=t.get(n);var s=u[n.tagName.toLowerCase()](n);if(e.isValue(i[r])&&i[r]!==""&&e.isValue(s))e.isArray(i[r])||(i[r]=[i[r]]),i[r].push(s);else if(e.isUndefined(i[r])||!i[r])i[r]=s||""}}),i},clear:function(e){var n=o(e);t.batch(n,function(e){switch(e.type.toLowerCase()){case"checkbox":case"radio":e.checked=!1;break;default:e.tagName&&e.tagName.toLowerCase()==="select"?e.selectedIndex=0:e.value=""}})},isDirty:function(e){var t=o(e),n=t.length,i,s,a,f;for(i=0;i<n;i++){a=t[i];if(a.className.toLowerCase().indexOf("derived")!=-1)continue;switch(a.type.toLowerCase()){case"checkbox":case"radio":if(a.checked!=a.defaultChecked)return!0;break;case"select-one":case"select-multiple":for(s=0;s<a.options.length;s++){f=a.options[s];if(f.selected!=f.defaultSelected&&u.optionValue(f)!="")return!0}break;default:if(r(a.value)!=r(a.defaultValue))return!0}}return!1},clean:function(e){var t=o(e),n=t.length,r,i,s,u;for(r=0;r<n;r++){s=t[r];switch(s.type.toLowerCase()){case"checkbox":case"radio":s.defaultChecked=s.checked;break;case"select-one":case"select-multiple":for(i=0;i<s.options.length;i++)u=s.options[i],u.defaultSelected=u.selected;break;default:s.defaultValue=s.value}}}}}(),YAHOO.register("orchestral-form",ORCHESTRAL.util.Form,{version:"7.9",build:"0"});
