/*
 * Copyright (c) Orchestral Developments Ltd (2001 - 2014).
 *
 * This document is copyright. Except for the purpose of fair reviewing, no part
 * of this publication may be reproduced or transmitted in any form or by any
 * means, electronic or mechanical, including photocopying, recording, or any
 * information storage and retrieval system, without permission in writing from
 * the publisher. Infringers of copyright render themselves liable for
 * prosecution.
 */
YAHOO.namespace("ORCHESTRAL.widget"),function(){var e=YAHOO.lang,t=YAHOO.util.Dom,n=YAHOO.util.Event,r=ORCHESTRAL.util.Locale,i=YAHOO.widget.Paginator,s="selected",o;o=function(){function r(e){var r=e.one(e.config.doc.body),i;n=new e.OHP.Popover({trigger:{delegate:{el:r,filter:".ohp-comment"},handler:function(e){this.set("bodyContent",e.one(".value").getContent())}},zIndex:4}),n.plug(e.OHP.Constraint,{maxWidth:"300px",maxHeight:"200px"}),n.set("bodyContent",""),n.render(),Modernizr.touch&&r.delegate("touchend",function(e){var t=e.currentTarget,r=t.one(".ohp-comment");r&&(n.setAttrs({bodyContent:r.one(".value").getContent()}),n.delayedShow({triggerNode:r}))},"td.ohp-dt-col-type-comments",self);while(i=t.pop())i(n)}var e=!1,t=[],n;return function(i){n?i(n):(t.push(i),e||(YUI().use("node-base","event-delegate","ohp-popover","ohp-constraint",r),e=!0))}}();var u=function(e){return new YAHOO.util.XHRDataSource(e,{connMethodPost:!0,connTimeout:45e3,connXhrMode:"ignoreStaleResponses",responseType:YAHOO.util.DataSource.TYPE_JSON,responseSchema:{resultsList:"data",metaFields:{totalRecords:"totalRecords"}}})},a=function(i,o,u,f){if(!t.get(i))return;f=e.merge({MSG_EMPTY:r.get("widget.datatable.empty.message"),MSG_SORTASC:r.get("widget.datatable.sort.ascending"),MSG_SORTDESC:r.get("widget.datatable.sort.descending"),naturalwidth:t.hasClass(i,"natural-content-width")},f||{}),o=YAHOO.widget.DataTable._cloneObject(o),t[f.naturalwidth?"addClass":"removeClass"](i,"natural-content-width"),f.multiRowSelection&&(o=[{key:s,label:'<input type="checkbox">',formatter:function(e,t,n,r){e.innerHTML='<input type="checkbox"'+(this.isSelected(t)?" checked":"")+"/>"}}].concat(o),t.addClass(i,"dt-row-selection-enabled"));if(f.dynamicData)this.handleDataReturnPayload=function(e,t,n){try{n.totalRecords=t.meta.totalRecords}catch(r){}return n};else{var c=f.sortedBy||null;this.handleDataReturnPayload=function(e,t,n){var r=this.get("sortedBy")||c;return r&&this.sortColumn(this.getColumn(r.key),r.dir),n}}f.paginatorConfig&&(f.paginator=new l(f.paginatorConfig.initialRecordCount,f.paginatorConfig.recordsPerPage));var h=document.createElement("div");i=t.get(i),i.parentNode.insertBefore(h,i),h.appendChild(i),a.superclass.constructor.call(this,i,o,u,f),!f.dynamicData&&f.stickyState&&this.subscribe("columnSortEvent",this._saveSort),this.subscribe("theadCellMouseoverEvent",this._onEventHighlightTheadCell),this.subscribe("theadCellMouseoutEvent",this._onEventUnhighlightTheadCell),ORCHESTRAL.env.ua.ie===8&&this.subscribe("postRenderEvent",function(){t.removeClass(this.getContainerEl(),"yui-dt"),t.addClass(this.getContainerEl(),"yui-dt")},null,this),this.subscribe("cellClickEvent",function(e){var r=e.target,i=n.getTarget(e.event);if(t.hasClass(i,"show-more"))return t.setStyle(r,"width",r.offsetWidth+"px"),t.addClass(r,"showing-more"),this.fireEvent("postRenderEvent"),n.preventDefault(e.event),!1;if(t.hasClass(i,"show-less"))return t.removeClass(r,"showing-more"),t.setStyle(r,"width",null),this.fireEvent("postRenderEvent"),n.preventDefault(e.event),!1}),f.footerEditor&&this.subscribe("postRenderEvent",function(e){this._initFooterEditor(f.editorAdd)},null,this);if(f.multiRowSelection){this.subscribe("theadCellClickEvent",function(e){return!this._handleRowSelection(e,function(e){var t=this.getRecordSet().getLength(),n;for(n=0;n<t;n++)this.getTrEl(this.getRecord(n))&&(this[(e?"":"un")+"selectRow"](n),this.updateCell(this.getRecord(n),0))})}),this.subscribe("cellClickEvent",function(e){return!this._handleRowSelection(e,function(t){this[(t?"":"un")+"selectRow"](e.target)})}),this.subscribe("unselectAllRowsEvent",function(e){var n;for(n=0;n<e.records.length;++n)this.updateCell(e.records[n],0);t.getElementsByClassName("yui-dt-col-selected","th",this.getTheadEl(),function(e){e.getElementsByTagName("input")[0].checked=!1})}),this.subscribe("renderEvent",function(){var e=this.getRecordSet().getLength(),n=0,r;for(r=0;r<e;r++)this.getTrEl(this.getRecord(r))&&n++;t.getElementsByClassName("yui-dt-col-selected","th",this.getTheadEl(),function(e){t[n?"removeClass":"addClass"](e.getElementsByTagName("input")[0],"dt-select-all-hidden")})});if(e.isObject(f.multiRowSelection)&&f.multiRowSelection.toolbar){var p=this.get("paginator"),d=f.multiRowSelection.toolbar,v=this;p&&!p.get("rendered")?p.subscribe("render",function(){v._initToolbar.call(v,d)}):this._initToolbar(d)}}this.subscribe("rowMouseoverEvent",this.onEventHighlightRow),this.subscribe("rowMouseoutEvent",this.onEventUnhighlightRow),this.subscribe("rowAddEvent",this._onRowAddOrUpdate),this.subscribe("rowUpdateEvent",this._onRowAddOrUpdate)};e.extend(a,YAHOO.widget.DataTable,{_autoRefresh:null,_addItemEl:null,_autoRefreshEl:null,_filterFormEl:null,_filterParams:{},_filterToggleEl:null,_lastSortedBy:null,_numberSelectedEl:null,_quickSearchEl:null,_toolbarButtons:[],_toolbarEl:null,_destroyContainerEl:function(e){t.removeClass(e,"filter-open"),a.superclass._destroyContainerEl.call(this,e)},_initContainerEl:function(e){var i=t.getFirstChildBy(e,function(e){return t.hasClass(e,"dt-filter")});this._filterFormEl=i,i&&e.removeChild(i),a.superclass._initContainerEl.call(this,e);if(i){var s=this,o=t.getElementsBy(function(e){return t.hasClass(e,"yui-primary-button")},"span",i)[0],u=t.getElementsByClassName("yui-buttongroup",null,i);o||(o=t.getElementsBy(function(e){return e.type==="submit"},"input",i)[0],o||(o=t.getElementsBy(function(e){return e.type==="submit"},"button",i)[0]));if(o){new ORCHESTRAL.widget.PrimaryButton(o);var f=function(e){s.performFilter(),n.preventDefault(e)};n.on(i,"submit",f,null,this),t.getElementsBy(function(e){return t.hasClass(e,"reset-filter")},"a",i,function(e){n.on(e,"click",function(e){s._filterFormEl.reset(),f(e)})})}else u.length>0&&t.batch(u,function(e){(new YAHOO.widget.ButtonGroup(e)).on("valueChange",this.performFilter,null,this)},this,!0);t.addClass(e,"filter-open")}var l=document.createElement("div");l.className="dt-tools"
,this._addItemEl=document.createElement("a"),this._addItemEl.className="add",this._addItemEl.href="#",this._filterToggleEl=document.createElement("a"),this._filterToggleEl.className="filter-toggle",this._filterToggleEl.href="#",this._filterToggleEl.title=r.get("widget.datatable.search.button"),this._autoRefreshEl=document.createElement("span"),this._quickSearchEl=document.createElement("span"),this._initQuickSearch(),l.appendChild(this._addItemEl),l.appendChild(this._filterToggleEl),l.appendChild(this._autoRefreshEl),l.appendChild(this._quickSearchEl),t.addClass(l.childNodes,"dt-tool"),t.addClass(l.childNodes,"dt-tool-disabled"),e.appendChild(l),i&&(t.addClass(i,"filter"),e.appendChild(i),YAHOO.widget.Button.addHiddenFieldsToForm(i),ORCHESTRAL.util.Form.deserialize(i,this.get("filterState")),this._filterParams=ORCHESTRAL.util.Form.serialize(i)),this.set("initialRequest",this.get("generateRequest")(this.getState(),this)),n.on(this._addItemEl,"click",function(e){this.fireEvent("addItemEvent"),n.preventDefault(e)},null,this),n.on(this._filterToggleEl,"click",function(r){var s=!t.hasClass(e,"filter-open"),o;t[s?"addClass":"removeClass"](e,"filter-open"),s?i.getElementsByTagName("input")[0].focus():o.value!==""&&(o.value="",this.fireEvent("searchEvent",{query:""})),n.preventDefault(r)},null,this),this.get("addItem")&&(ORCHESTRAL.util.Dom.setText(this._addItemEl,this.get("addItem").label),t.addClass(this._addItemEl,"dt-tool-enabled")),this.get("searchHandler")&&t.addClass(this._quickSearchEl,"dt-tool-enabled"),this.get("autoRefreshInterval")&&this._initAutoRefresh()},_initTableEl:function(e){a.superclass._initTableEl.call(this,e),t.addClass(this._elTable,"data")},_initAutoRefresh:function(){if(!this.get("autoRefreshInterval"))return;this._autoRefresh=new ORCHESTRAL.widget.AutoRefresh(this._autoRefreshEl,this.get("element"),this.get("autoRefreshInterval"),this._requestData,this);var e=this.handleDataReturnPayload;t.addClass(this._autoRefreshEl,"dt-tool-enabled"),this.handleDataReturnPayload=function(t,n,r){return this._autoRefresh.updateMessage(),e.call(this,t,n,r)}},pauseAutoRefresh:function(){this._autoRefresh&&this._autoRefresh.pause()},unpauseAutoRefresh:function(){this._autoRefresh&&this._autoRefresh.unpause()},_initQuickSearch:function(){var e=this._quickSearchEl;t.addClass(e,"dt-quick-search");var n=document.createElement("input");n.type="text",t.addClass(n,"short"),e.appendChild(n),(new YAHOO.util.KeyListener(n,{keys:YAHOO.util.KeyListener.KEY.ENTER},{fn:function(){this.fireEvent("searchEvent",{query:n.value})},scope:this,correctScope:!0})).enable();var r=new ORCHESTRAL.widget.IconButton({label:"&nbsp",type:"quick-search",icon:"icon-search",container:e,onclick:{fn:function(){this.fireEvent("searchEvent",{query:n.value})},scope:this}})},_initToolbar:function(n){var r,i=n.buttons,s,o,u;this._toolbarEl=t.getElementsByClassName("dt-toolbar","div",this.getContainerEl())[0],this._toolbarEl?t.removeClass(this._toolbarEl,"dt-toolbar-loading"):(this._toolbarEl=document.createElement("div"),t.addClass(this._toolbarEl,"dt-toolbar"),t.insertAfter(this._toolbarEl,this.getTableEl()));if(i&&i.length>0){this._toolbarButtons=[],s=document.createElement("span"),t.addClass(s,"dt-toolbar-buttons");for(u=0;u<i.length;++u)r=i[u],o=new ORCHESTRAL.widget[r.isDefault?"PrimaryButton":"SecondaryButton"]({label:r.text,id:r.id}),o.appendTo(s),e.isFunction(r.handler)?o.set("onclick",{fn:r.handler,obj:this,scope:this}):e.isObject(r.handler)&&e.isFunction(r.handler.fn)&&o.set("onclick",{fn:r.handler.fn,obj:e.isUndefined(r.handler.obj)?this:r.handler.obj,scope:r.handler.scope||this}),this._toolbarButtons.push(o);this._toolbarEl.appendChild(s)}this._numberSelectedEl=document.createElement("span"),t.addClass(this._numberSelectedEl,"dt-num-selected"),this._toolbarEl.appendChild(this._numberSelectedEl),this.subscribe("rowSelectEvent",this._updateToolbarState,null,this),this.subscribe("rowUnselectEvent",this._updateToolbarState,null,this),this.subscribe("unselectAllRowsEvent",this._updateToolbarState,null,this),this._updateToolbarState(),this.setAttributeConfig("toolbarRendered",{value:!0}),this.fireEvent("toolbarRender",{toolbar:this._toolbarEl})},_updateToolbarState:function(){var n=this.getSelectedRecords().length,r,i;if(this._toolbarEl){if(this._numberSelectedEl){switch(n){case 0:r=this.get("MSG_NONE_SELECTED");break;case 1:r=this.get("MSG_ONE_SELECTED");break;default:r=e.substitute(this.get("MSG_NUM_SELECTED"),[n])}this._numberSelectedEl.innerHTML=r}for(i=0;i<this._toolbarButtons.length;++i)this._toolbarButtons[i].set("disabled",n===0);n>0?(t.addClass(this._toolbarEl,"dt-toolbar-enabled"),t.removeClass(this._toolbarEl,"dt-toolbar-disabled"),this.fireEvent("toolbarEnabled",{toolbar:this._toolbarEl})):(t.removeClass(this._toolbarEl,"dt-toolbar-enabled"),t.addClass(this._toolbarEl,"dt-toolbar-disabled"),this.fireEvent("toolbarDisabled",{toolbar:this._toolbarEl}))}},_defaultPaginatorContainers:function(e){var n=this._sId+"-paginator",r=t.get(n);return e&&!r&&(r=document.createElement("div"),r.id=n,this._elContainer.appendChild(r)),r},_handleRowSelection:function(e,r){if(!t.hasClass(e.target,"yui-dt-col-"+s))return!1;var i=n.getTarget(e.event);return i.tagName!=="INPUT"&&(i=e.target.getElementsByTagName("input")[0],i.checked=!i.checked),r.call(this,i.checked),!0},_initFooterEditor:function(e){var r=this.getColumnSet(),i=this._elTbody,s=t.getElementsByClassName("yui-dt-footer-editor",null,i),o,u,a,f,l,c,h,p,d,v;if(s.length>0||!r)return;o=i.getElementsByTagName("tr"),u=t.getElementsByClassName("yui-dt-last","tr",i),a=document.createElement("tr"),t.removeClass(u,"yui-dt-last"),t.addClass(a,"yui-dt-footer-editor"),t.addClass(a,"yui-dt-last"),t.addClass(a,o.length%2===0?"yui-dt-even":"yui-dt-odd");for(v=0;v<r.keys.length;v++)f=r.keys[v].editor,h=document.createElement("td"),f?(p=document.createElement("div"),l=f._elContainer,t.setStyle(l,"display",""),t.addClass(p,"yui-dt-liner"),c=l.getElementsByTagName("input")[0],c.setAttribute
("tabindex",0),n.removeListener(c,"keypress"),n.addListener(c,"keypress",function(e){e.keyCode===13&&YAHOO.util.Event.preventDefault(e)}),l.removeAttribute("tabindex"),p.appendChild(l),h.appendChild(p),t.addClass(h,v===0?"yui-dt-first":"yui-dt-edit")):r.keys[v].formatter[0]==="action"?(d=document.createElement("a"),p=document.createElement("div"),t.addClass(h,"yui-dt-last"),t.addClass(p,"yui-dt-liner"),t.addClass(d,"icon-add"),d.setAttribute("href","#"),p.appendChild(d),h.appendChild(p)):(h.innerHTML=" - ",v===0&&t.addClass(h,"yui-dt-first")),a.appendChild(h);n.addListener(a.getElementsByTagName("a"),"click",function(t){var i={},s=a.getElementsByTagName("input"),o;n.preventDefault(t);for(o=0;o<s.length;o++)i[r.keys[o].key]=s[o].value,s[o].value="";e(i)},a,this),this._elTbody.appendChild(a)},_requestData:function(e){var t=this.getState(),n=e?e.animate:!0;this.getDataSource().sendRequest(this.get("generateRequest")(t,this),{success:this._onDataReturnReplaceRows,failure:this._onDataReturnReplaceRows,argument:{state:t,animate:n},scope:this})},_onDataReturnReplaceRows:function(e,t,n){this.onDataReturnReplaceRows(e,t,n.state,n.animate)},onDataReturnReplaceRows:function(e,n,r,i){var s=this._elTbody.children.length,o=[],u,f;for(f=0;f<s;f++)o.push(this._elTbody.children[f]);s!==0&&(u=this._elTbody.children[0].children.length),a.superclass.onDataReturnReplaceRows.call(this,e,n,r);var l=this._elTbody.children.length,c=0,h=0,p=0,d=0,v,m,g,y,b=/\bid=("\S[^>\s]+"|\S[^>\s]+)/g,w=/\s/g,E=!0,S=!1,x=this.getState();x.selectedRows.length!==0&&(S=!0,this.unselectAllRows());if(!u&&l===0)return;for(c=0;c<s;c++){v=o[c];for(h=p;h<l;h++){m=this._elTbody.children[h];for(d=0;d<u;d++){if(t.hasClass(v.children[d],"yui-dt-col-selected")){d++;if(d>=u)break}g=v.children[d].innerHTML.replace(b,"").replace(w,""),y=m.children[d].innerHTML.replace(b,"").replace(w,"");if(g!==y){E=!1;break}}if(E){S&&t.hasClass(v,"yui-dt-selected")&&this.selectRow(this._elTbody.children[h]);if(i&&h>p)for(f=p;f<h;f++)this.fireEvent("rowAddEvent",{record:this.getRecord(this._elTbody.children[f])});p=h+1;break}E=!0}}S&&t.batch(this.getSelectedRows(),function(e){t.getElementsBy(function(e){return e.getAttribute("type")==="checkbox"},"input",e,function(e){e.setAttribute("checked","checked")})}),x=this.getState();if(i&&!(x.pagination&&x.pagination.rowsPerPage<x.pagination.totalRecords))for(f=p;f<l;f++)this.fireEvent("rowAddEvent",{record:this.getRecord(this._elTbody.children[f])})},sortColumn:function(e,t){if(e&&e instanceof YAHOO.widget.Column){var n=this.get("sortedBy")||{},r=n.key===e.key?!0:!1;r&&(t=t||this.getColumnSortDir(e)),this.set("sortedBy",null),a.superclass.sortColumn.call(this,e,t)}},onEventSortColumn:function(e){var n=this.getThEl(e.target);a.superclass.onEventSortColumn.call(this,e);if(n&&t.hasClass(n,YAHOO.widget.DataTable.CLASS_SORTABLE)){var r=function(){n.getElementsByTagName("a")[0].focus()};if(this.get("dynamicData")){var i=function(){r(),this.removeListener("postRenderEvent",i)};this.addListener("postRenderEvent",i)}else r()}},_saveSort:function(){var e=this.getState(),t=e.sortedBy;if(!this._lastSortedBy){this._lastSortedBy=t;return}if(this._lastSortedBy.key===t.key&&this._lastSortedBy.dir===t.dir)return;this.getDataSource().sendRequest(this._getQuery(this._getSortParams(e))),this._lastSortedBy=t},_getSortParams:function(e){return{dir:e.sortedBy&&e.sortedBy.dir===YAHOO.widget.DataTable.CLASS_DESC?"desc":"asc",sort:e.sortedBy?e.sortedBy.key:this.getColumnSet().keys[0].getKey()}},_getQuery:function(e){var t={},n;for(n in e)e.hasOwnProperty(n)&&(t[this.get("dataRequestPrefix")+"."+n]=e[n]);return ORCHESTRAL.util.Form.toQueryString(t)},_onEventHighlightTheadCell:function(e){var n=this.getThEl(e.target);n&&t.addClass(n,YAHOO.widget.DataTable.CLASS_HIGHLIGHTED)},_onEventUnhighlightTheadCell:function(e){var n=this.getThEl(e.target);n&&t.removeClass(n,YAHOO.widget.DataTable.CLASS_HIGHLIGHTED)},_onRowAddOrUpdate:function(e){var n=e.record,r=t.get(n._sId),i=t.getStyle(r,"backgroundColor"),s;s=new YAHOO.util.ColorAnim(r,{backgroundColor:{from:"#aad3eF",to:"white"===i?"#fff":i}}),s.onComplete.subscribe(function(){t.setStyle(r,"backgroundColor","")}),s.animate()},performFilter:function(){if(!this._filterFormEl)return;YAHOO.widget.Button.addHiddenFieldsToForm(this._filterFormEl),this._filterParams=ORCHESTRAL.util.Form.serialize(this._filterFormEl),this._requestData({animate:!1})},deleteRow:function(e){var n=YAHOO.lang.isNumber(e)?this.getRecordSet().getRecord(e):t.get(e);n&&this.unselectRow(n),a.superclass.deleteRow.call(this,e)},formatCell:function(e,t,n){t=t||this.getRecord(e),n=n||this.getColumn(e.parentNode.cellIndex);if(t&&n){var r=n.field,i=!0,s=!0,o;if(n.formatter){var u,a;n.formatter=YAHOO.lang.isArray(n.formatter)?n.formatter:[n.formatter];for(a=0;a<n.formatter.length;++a){u=n.formatter[a],o=YAHOO.lang.isFunction(u)?u:YAHOO.widget.DataTable.Formatter[u]||YAHOO.widget.DataTable.Formatter.defaultFormatter;if(o){var f=o.call(this,e,t,n,t.getData(r)),l=!1;f?(s=f.preventDefault?!1:s,i=f.preventEmptyCellFormatting?!1:i,l=f.stopFormatting?!0:l):l=!0;if(l){s=!1,i=!1;break}}else e.innerHTML=t.getData(r)}}s&&(o=YAHOO.widget.DataTable.Formatter.defaultFormatter,o.call(this,e,t,n,t.getData(r))),i&&(o=YAHOO.widget.DataTable.Formatter.emptyCellFormatter,o.call(this,e,t,n,t.getData(r))),this.fireEvent("cellFormatEvent",{record:t,column:n,key:n.key,el:e})}},formatTheadCell:function(e,n,i){var s=t.getAncestorByClassName(e,"icon")!==null,o=n.label,u=this.getThEl(n);s&&(n.label=""),u.setAttribute("aria-busy","true"),a.superclass.formatTheadCell.call(this,e,n,i),t.getElementsByClassName(YAHOO.widget.DataTable.CLASS_SORTABLE,"a",e,function(e){var u=(n.sortOptions||{}).defaultDir,a;t.addClass(e,"default-sort-"+(u===YAHOO.widget.DataTable.CLASS_DESC||u==="desc"?"desc":"asc")),s&&(e.title=o+" - "+e.title),a="",i&&i.key===n.key&&(a=(i.dir===YAHOO.widget.DataTable.CLASS_DESC||i.dir==="desc"?r.get("cow.datatable.tooltip.screenReader.sortedDescending"):r.get("cow.datatable.tooltip.screenReader.sortedAscending"
))+". "),e.innerHTML+='<span class="ohp-dt-header-icon"></span>',e.innerHTML+='<span class="ohp-dt-sort-icon"></span>',e.innerHTML+='<span class="ohp-screen-reader-only">. '+a+e.title+".</span>"}),s&&e.childNodes.length===0&&(e.title=o),n.sortable||(e.innerHTML+='<span class="ohp-dt-header-icon"></span>'),n.label=o,u.setAttribute("aria-busy","false")},getSelectedRecords:function(){var e=[],t,n;for(t=0,n=this.getSelectedRows();t<n.length;t++)e.push(this.getRecord(n[t]));return e},getToolbarEl:function(){return this._toolbarEl},isToolbarEnabled:function(){return this._toolbarEl&&t.hasClass(this._toolbarEl,"dt-toolbar-enabled")},getFilterForm:function(){return this._filterFormEl},beginWait:function(){},endWait:function(){},initAttributes:function(i){a.superclass.initAttributes.call(this,i),this.setAttributeConfig("MSG_NONE_SELECTED",{value:r.get("widget.datatable.noneSelected.message"),validator:e.isString}),this.setAttributeConfig("MSG_NUM_SELECTED",{value:r.get("widget.datatable.numberSelected.message"),validator:e.isString});var s=this;this.setAttributeConfig("MSG_ONE_SELECTED",{value:e.substitute(s.get("MSG_NUM_SELECTED"),[1]),validator:e.isString}),this.setAttributeConfig("toolbarRendered",{readOnly:!0,value:!1}),this.setAttributeConfig("autoRefreshInterval",{validator:e.isNumber,method:function(e){this._autoRefreshEl&&this._initAutoRefresh()}}),this.setAttributeConfig("dataRequestPrefix",{validator:e.isString,method:function(t){this.set("generateRequest",function(t,n){var r=n._filterParams;return n.get("dynamicData")&&(r=e.merge(r,n._getSortParams(t),{results:t.pagination?t.pagination.rowsPerPage:"",startIndex:t.pagination?t.pagination.recordOffset:0})),n._getQuery(r)})}}),this.setAttributeConfig("fallbackSortOptions",{method:function(e){var t=this.getColumnSet().flat,n;for(n=0;n<t.length;n++){var r=t[n].sortOptions||{};r.field=r.field||t[n].field,t[n].sortOptions={defaultDir:r.defaultDir||YAHOO.widget.DataTable.CLASS_ASC,sortFunction:a.getSortFunction(r,e,{sortFunction:a._compareRecordCounts})}}}}),this.setAttributeConfig("filterState",{value:{}}),this.setAttributeConfig("rowClickHandler",{writeOnce:!0,validator:e.isFunction,method:function(e){this.subscribe("rowClickEvent",ORCHESTRAL.util.Event.debounce(function(t){var n=this.getRecord(t.target);n&&e.call(this,n)})),this.subscribe("rowHighlightEvent",function(e){t.addClass(e.el,"yui-dt-clickable-highlighted"),this.isSelected(e.record)&&t.addClass(e.el,"yui-dt-selected-highlighted")}),this.subscribe("rowUnhighlightEvent",function(e){t.removeClass(e.el,"yui-dt-clickable-highlighted"),t.removeClass(e.el,"yui-dt-selected-highlighted")}),this.subscribe("rowSelectEvent",function(e){t.hasClass(e.el,"yui-dt-highlighted")&&t.addClass(e.el,"yui-dt-selected-highlighted")}),this.subscribe("rowUnselectEvent",function(e){t.removeClass(e.el,"yui-dt-selected-highlighted")})}}),this.setAttributeConfig("searchHandler",{writeOnce:!0,validator:e.isFunction,method:function(e){this.subscribe("searchEvent",function(t){e.call(this,t.query)}),t.addClass(this._filterToggleEl,"dt-tool-enabled")}}),this.setAttributeConfig("toggleHandlers",{writeOnce:!0,method:function(e){this.subscribe("cellClickEvent",function(i){var s=i.target,o=this.getColumn(s),u,a,f;if(!o)return!0;u=this.getTdLinerEl(s),a=e[o.key],f=u.parentNode;if(!a)return!0;if(t.hasClass(f,"toggle-working"))return!1;var l=this.getRecord(s),c=!l.getData(o.key),h=this;t.removeClass(f,"toggle-failed"),f.title="",t.addClass(f,"toggle-working"),t.hasClass(u,"off")?t.replaceClass(u,"off","on-working"):t.hasClass(u,"on")&&t.replaceClass(u,"on","off-working");var p=YAHOO.lang.later(1e3,{},function(){t.hasClass(u,"off-working")?t.replaceClass(u,"off-working","off-throbber"):t.hasClass(u,"on-working")&&t.replaceClass(u,"on-working","on-throbber")}),d=function(e){if(e===!1){t.addClass(f,"toggle-failed"),f.title=r.get("widget.toggle.problemChanging");var i=function(){t.removeClass(f,"toggle-failed"),f.title="",n.removeListener(f,"mouseenter",i)};n.addListener(f,"mouseenter",i)}else h.updateCell(l,o,c);t.hasClass(u,"off-working")?t.replaceClass(u,"off-working",e===!1?"on":"off"):t.hasClass(u,"on-working")?t.replaceClass(u,"on-working",e===!1?"off":"on"):t.hasClass(u,"on-throbber")?t.replaceClass(u,"on-throbber",e===!1?"off":"on"):t.hasClass(u,"off-throbber")&&t.replaceClass(u,"off-throbber",e===!1?"on":"off"),t.removeClass(f,"toggle-working"),p.cancel()};return a.call(this,l,d),!1})}}),this.setAttributeConfig("priorityHandler",{writeOnce:!0,method:function(e){var n={},r={};this.subscribe("cellClickEvent",function(i){var s=i.target,o=this.getColumn(s),u,a;if(!o)return!0;u=this.getTdLinerEl(s),a=e[o.key];if(!a)return!0;if(t.hasClass(u.parentNode,"priority-view"))return!1;var f=this,l=this.getRecord(s),c=l.getId(),h=c+o.key,p=l.getData(o.key),d="priority-"+p,v,m,g,y;if(t.hasClass(u.parentNode,"priority-change-failed"))return t.removeClass(s,"priority-change-failed"),f.updateCell(l,o,p),!1;if(t.hasClass(u.parentNode,"priority-working"))return t.hasClass(u,"priority-throbber")||t.addClass(u,"priority-throbber"),!1;for(y=0;y<4;y++)t.hasClass(u,"priority-"+y)&&(v=(y+1)%4,g="priority-"+y);return m="priority-"+v,t.replaceClass(u,g,m),r[h]&&r[h].cancel(),r[h]=YAHOO.lang.later(750,{},function(){if(m===d)return;f.fireEvent("priorityChangeEvent",{recordId:c}),t.addClass(u.parentNode,"priority-working"),n[h]&&n[h].cancel(),n[h]=YAHOO.lang.later(750,{},function(){t.hasClass(u.parentNode,"priority-working")&&t.addClass(u,"priority-throbber")}),a.call(this,l,v,function(e){e?f.updateCell(l,o,v):(t.replaceClass(u,m,d),t.addClass(u.parentNode,"priority-change-failed"),f.updateCell(l,o,p)),t.removeClass(u.parentNode,"priority-working"),t.removeClass(u,"priority-throbber"),n[h].cancel(),r[h].cancel(),delete n[h],delete r[h]})}),!1})}}),this.setAttributeConfig("addItem",{writeOnce:!0,validator:function(t){return e.isFunction(t.fn)&&e.isString(t.label)},method:function(e){this.subscribe("addItemEvent",e.fn),this._addItemEl&&(ORCHESTRAL.util
.Dom.setText(this._addItemEl,e.label),t.addClass(this._addItemEl,"dt-tool-enabled"))}}),this.setAttributeConfig("removeActionHandler",{validator:e.isFunction})},showTableMessage:function(e,n){a.superclass.showTableMessage.call(this,e,n),(!this._elMsgTbody.parentNode||this._elMsgTbody.parentNode.nodeType===11)&&t.insertBefore(this._elMsgTbody,this.getTbodyEl())},hideTableMessage:function(){this._elMsgTbody.parentNode&&this._elMsgTbody.parentNode.nodeType!==11&&(this._elMsgTbody.parentNode.removeChild(this._elMsgTbody),this.fireEvent("tableMsgHideEvent"))}}),a.prototype._initTheadEl=function(e){e=e||this.getTableEl(),a.superclass._initTheadEl.call(this,e);var n=this.getColumnSet(),r,i,s,o,u,f;if(!n)return;r=n.keys.length,i=t.getElementsByClassName("yui-dt-tbody-min-width","thead",e)[0],i?t.getElementsByClassName("min-width","th",i,function(e){e.colSpan=r}):(s=document.createElement("tbody"),t.addClass(s,"yui-dt-tbody-min-width"),o=document.createElement("tr"),u=document.createElement("th"),t.addClass(u,"min-width"),u.colSpan=r,o.appendChild(u),s.appendChild(o),f=this.getTheadEl(),t.insertAfter(s,f))},a.prototype._initCommentPopover=function(){if(this._commentPopoverInitialized)return;var e=this;o(function(t){t.on("show",e.pauseAutoRefresh,e),t.on("hide",e.unpauseAutoRefresh,e)}),this.subscribe("cellClickEvent",function(e){var n=e.target,r=this.getColumn(n),i;if(r){i=this.getTdLinerEl(n);if(t.hasClass(t.getChildren(i)[0],"ohp-comment"))return!1}}),this._commentPopoverInitialized=!0},e.augmentObject(a,{UNREAD_ROW_FORMATTER:function(e,n){return t[n.getData("unread")?"addClass":"removeClass"](e,"unread"),!0},_compareRecordCounts:function(e,t,n){return YAHOO.util.Sort.compare(e.getCount(),t.getCount(),n)},formatBoolean:function(n,r,i,s){var o=e.isBoolean(s)&&s;return n.className=YAHOO.widget.DataTable.CLASS_LINER,t.addClass(n,o?"on":"off"),{preventDefault:!0,preventEmptyCellFormatting:!0}},formatDefault:function(e,t,n,r){var i=t.getData(n.key+"Display");return r=i===undefined?r:i,e.innerHTML!==r&&YAHOO.widget.DataTable.formatDefault(e,t,n,r),e.title=t.getData(n.key+"Tooltip")||"",{}},formatEmptyCell:function(e,t,n,r){if(YAHOO.lang.trim(e.innerHTML)==="&nbsp;"||YAHOO.lang.trim(e.innerHTML)==="")e.innerHTML="&ndash;";return{}},formatMoreLess:function(t,n,i,s){var o=function(t,n){return e.substitute('<span class="less">{lessValue} <a href="#" class="show-more">{moreLink}</a></span><span class="more">{moreValue} <a href="#" class="show-less">{lessLink}</a></span>',{lessValue:t,moreValue:n,lessLink:r.get("widget.datatable.less.action"),moreLink:r.get("widget.datatable.more.action")})},u=null,a=n.getData(i.key+"More");if(a)u=o(s,a);else{if(!s)return{};if(s.length<=75)u=s;else{var f=50,l;for(l=f;l<f+10;l++){if(s.charAt(l)==="&")break;if(s.charAt(l)===";"){f=l+1;break}}u=o(s.substring(0,f)+"&hellip;",s)}}return t.innerHTML=u,{preventDefault:!0}},formatState:function(e,n,r,i){return e.className=YAHOO.widget.DataTable.CLASS_LINER,t.addClass(e,r.key+"-"+i),{preventDefault:!0,preventEmptyCellFormatting:!0}},formatComment:function(e,n,r,i){this._initCommentPopover(),t.addClass(t.getAncestorByTagName(e,"td"),"ohp-dt-col-type-comments");var s=n.getData(r.key+"Display"),o=s;s===undefined&&(YAHOO.lang.trim(e.innerHTML)!=="&nbsp;"&&YAHOO.lang.trim(e.innerHTML)!==""?o="<span>"+e.innerHTML+"</span>":o=i);if(YAHOO.lang.trim(o)!=="&nbsp"&&YAHOO.lang.trim(o)!==""){var u='<span class="ohp-comment"><span class="value ohp-comment-content ohp-comment-value">'+o+"</span></span>";YAHOO.widget.DataTable.formatDefault(e,n,r,u),e.title=n.getData(r.key+"Tooltip")||""}return{preventDefault:!0}},formatPriority:function(n,i,s,o){var u=e.isNumber(o)&&o<4?o:0,a,f;return n.className=YAHOO.widget.DataTable.CLASS_LINER,t.addClass(n,"priority-"+u),a=t.hasClass(n.parentNode,"priority-change-failed")?r.get("cow.datatable.tooltip.priority.changeFailed"):u===0?r.get("widget.priority.priorityNone"):u===1?r.get("widget.priority.priorityLow"):u===2?r.get("widget.priority.priorityMedium"):u===3?r.get("widget.priority.priorityHigh"):"",f=i.getData(s.key+"Tooltip"),f=f===undefined?"":", "+f,n.title=a+f,{preventDefault:!0,preventEmptyCellFormatting:!0}},formatAction:function(e,t,r,i){var s={preventDefault:!0,preventEmptyCellFormatting:!0};e.className="dt-delete";var o=t.getData();if(this.getAttributeConfig("removeActionHandler").value===null)return s;var u=this.getAttributeConfig("removeActionHandler").value;if(t.getData()!==null){e.innerHTML='<div class="yui-dt-liner"><a href="#" class="icon-remove"> </a></div>';var a=e.firstChild,i=t.getData(),f=t.getId();n.addListener(a,"click",function(e,t){n.preventDefault(e),u(i,f)},null,this)}return s},formatThrobber:function(e,t,n,r){var i=t.getData();e.className=YAHOO.widget.DataTable.CLASS_LINER;var s,o;return{preventDefault:!0,preventEmptyCellFormatting:!0}},getSortFunction:function(){var e=Array.prototype.slice.apply(arguments);return function(t,n,r){var i=0,s;for(s=0;i===0&&s<e.length;s++){var o=e[s];i=o.sortFunction?o.sortFunction(t,n,r):YAHOO.util.Sort.compare(t.getData(o.field),n.getData(o.field),r)}return i}}}),e.augmentObject(YAHOO.widget.DataTable.Formatter,{"boolean":a.formatBoolean,priority:a.formatPriority,moreless:a.formatMoreLess,state:a.formatState,comment:a.formatComment,titlecase:a.formatTitleCase,defaultFormatter:a.formatDefault,emptyCellFormatter:a.formatEmptyCell,action:a.formatAction},!0);var f=function(){};f.prototype={render:function(){var e=document.createElement("div");return t.addClass(e,"dt-toolbar"),t.addClass(e,"dt-toolbar-loading"),e}};var l=function(t,n){return new i({rowsPerPage:t,template:"{ShowMoreLink} {DataTableToolbar} {MinimalCurrentPageReport}",pageReportTemplate:e.substitute(r.get("widget.datatable.showingXofY.message"),["{endRecord}","{totalRecords}"]),showMoreRows:n})},c=function(e){c.superclass.constructor.call(this,e)};e.extend(c,i.ui.CurrentPageReport,{update:function(e){if(e&&e.prevValue===e.newValue)return;var t=this.paginator.get("pageReportValueGenerator")
(this.paginator);t.totalRecords>0?this.span.innerHTML=i.ui.CurrentPageReport.sprintf(this.paginator.get("pageReportTemplate"),t):this.span.innerHTML=""}});var h=function(e){this.paginator=e,e.subscribe("rowsPerPageChange",this.update,this,!0),e.subscribe("totalRecordsChange",this.update,this,!0),e.subscribe("rowsPerPageChange",this.loadingComplete,this,!0),e.subscribe("totalRecordsChange",this.loadingComplete,this,!0),e.subscribe("destroy",this.destroy,this,!0)};h.init=function(t){t.setAttributeConfig("showMoreRows",{validator:e.isNumber})},h.prototype={render:function(){this.showMore=document.createElement("div"),this.showMore.className="yui-pg-show-more";var e=document.createElement("span");return e.className="yui-dt-loading",this.showMore.appendChild(e),this.link=document.createElement("a"),this.link.href="#",this.link.innerHTML=r.get("widget.datatable.showMore.action"),this.showMore.appendChild(this.link),this.update(),n.on(this.link,"click",this.onClick,this,!0),this.showMore},_getContainer:function(){return this.container||(this.container=t.getAncestorByClassName(this.showMore,"yui-dt")),this.container},update:function(){t[this.paginator.getTotalRecords()===i.VALUE_UNLIMITED||this.paginator.getTotalRecords()>this.paginator.getRowsPerPage()?"addClass":"removeClass"](this.showMore,"yui-pg-more-to-show")},loading:function(){t.addClass(this._getContainer(),"yui-pg-loading")},loadingComplete:function(){t.removeClass(this._getContainer(),"yui-pg-loading")},destroy:function(){n.purgeElement(this.link),this.showMore.parentNode.removeChild(this.showMore),this.link=null,this.showMore=null},onClick:function(e){var t=this.paginator,r=t.getRowsPerPage()+t.get("showMoreRows");t.getTotalRecords()!==i.VALUE_UNLIMITED&&r+t.get("showMoreRows")>t.getTotalRecords()&&(r=t.getTotalRecords()),this.loading(),t.setRowsPerPage(r),n.stopEvent(e)}},ORCHESTRAL.widget.DataTable=a,ORCHESTRAL.widget.DataTable.XHRDataSource=u,ORCHESTRAL.widget.DataTablePaginator=l,i.ui.DataTableToolbar=f,i.ui.ShowMoreLink=h,i.ui.MinimalCurrentPageReport=c}(),YAHOO.register("orchestral-datatable",ORCHESTRAL.widget.DataTable,{version:"7.9",build:"0"});
