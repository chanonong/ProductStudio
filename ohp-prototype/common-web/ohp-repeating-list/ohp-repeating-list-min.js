/*
 * Copyright (c) Orchestral Developments Ltd (2001 - 2014).
 *
 * This document is copyright. Except for the purpose of fair reviewing, no part
 * of this publication may be reproduced or transmitted in any form or by any
 * means, electronic or mechanical, including photocopying, recording, or any
 * information storage and retrieval system, without permission in writing from
 * the publisher. Infringers of copyright render themselves liable for
 * prosecution.
 */
YUI.add("ohp-repeating-list",function(e,t){"use strict";var n,r;r=e.Base.create("repeatingList",e.Widget,[e.WidgetChild],{ROOT_TYPE:n,BOUNDING_TEMPLATE:"<li></li>",CONTENT_TEMPLATE:"<div></div>",renderUI:function(){var t=this.get("contentBox"),n=e.substitute('<div class="{className}"></div>',{className:this.getClassName("value")});t.setContent(n),t.insert('<a href="#" class="icon-remove" tabindex="0"><span class="ohp-screen-reader-only">'+e.Escape.html(e.OHP.Locale.get("widget.repeatingList.item.action.remove"))+"</span>&nbsp;</a>","after")},bindUI:function(){this.after("valueChange",this.syncUI)},syncUI:function(){var e=this.get("contentBox").one("."+this.getClassName("value"));e.setContent(this.get("value"))}},{CSS_PREFIX:"ohp-repeating-list-item",ATTRS:{value:{setter:function(e){return this.get("parent").fire("updateChild",{child:this}),e},value:"",validator:e.Lang.isString},propertyIndex:{value:0,validator:e.Lang.isNumber,writeOnce:!0}},HTML_PARSER:{value:function(e){return e.getContent()}}}),n=e.Base.create("repeatingList",e.Widget,[e.WidgetParent,e.WidgetStdMod],{CONTENT_TEMPLATE:"<ul></ul>",initializer:function(){var e=this,t=this.get("contentBox").all(".yui3-widget-bd > ul > li"),n=0;t.each(function(t){e.add({value:t.getContent()}),t.set("propertyIndex",n+=1)}),this._set("propertyIndex",n)},renderUI:function(){var t=this.getStdModNode(e.WidgetStdMod.BODY),n=this.get("labelledBy"),r=this.get("describedBy"),i;t.hasChildNodes()||this.setStdModContent(e.WidgetStdMod.BODY,this.CONTENT_TEMPLATE),i=t.one("ul"),n&&i.setAttribute("aria-labelledby",n),r&&i.setAttribute("aria-describedby",r),i.removeClass("ohp-list"),i.empty(),this._childrenContainer=i},bindUI:function(){var t=this.getStdModNode(e.WidgetStdMod.FOOTER),n=t.one(".icon-add")||t.one(".add");n.on("click",function(t){var n=this.get("addHandler"),r;t.preventDefault(),n&&(r=e.bind(n,this),r())},this),this.getStdModNode(e.WidgetStdMod.BODY).delegate("click",function(e){var t=e.target.ancestor("."+this.getClassName("item"));this.some(function(e){if(e.get("boundingBox")===t)return this.remove(e.get("index")),this.triggerReflow(),!0},this),e.preventDefault()},".icon-remove",this),this.after("addChild",function(){var e=this.get("propertyIndex");this._set("propertyIndex",e+1),this.triggerReflow()})},triggerReflow:function(){var t;e.UA.ie&&e.UA.ie<=8&&(t=this.get("boundingBox"),t.set("className",t.get("className")))}},{CSS_PREFIX:"ohp-repeating-list",ATTRS:{defaultChildType:{value:r},addHandler:{value:function(){},validator:e.Lang.isFunction,writeOnce:!0},itemTemplate:{value:"",validator:e.Lang.isString,writeOnce:!0},propertyIndex:{value:0,validator:e.Lang.isNumber,readOnly:!0},labelledBy:{validator:e.Lang.isString,writeOnce:!0},describedBy:{validator:e.Lang.isString,writeOnce:!0}},HTML_PARSER:{itemTemplate:function(t){var n=t.one("script");return n?e.Lang.trim(n.getContent()):""}}}),e.namespace("OHP").RepeatingList=n},"7.9.0",{requires:["ohp-locale-base","node-style","substitute","node-event-delegate","escape","event-base","node-base","ohp-locale-translations","widget-stdmod","base","widget-child","arraylist","widget","widget-parent","oop"],skinnable:!0});
