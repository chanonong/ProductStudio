/*
 * Copyright (c) Orchestral Developments Ltd (2001 - 2014).
 *
 * This document is copyright. Except for the purpose of fair reviewing, no part
 * of this publication may be reproduced or transmitted in any form or by any
 * means, electronic or mechanical, including photocopying, recording, or any
 * information storage and retrieval system, without permission in writing from
 * the publisher. Infringers of copyright render themselves liable for
 * prosecution.
 */
YUI.add("ohp-change-exclude-item-plugin",function(e,t){function r(){r.superclass.constructor.apply(this,arguments)}var n=e.OHP.Locale;r.NAME="changeExcludeListItemPlugin",r.NS="changeExcludeItem",r.ATTRS={changeHandler:{value:function(){},validator:e.Lang.isFunction,writeOnce:!0}},e.extend(r,e.Plugin.Base,{initializer:function(){var t=this.get("host");this.afterHostMethod("render",this._afterRender),this.afterHostEvent("addChild",this._afterChildAddOrUpdate),this.afterHostEvent("updateChild",this._afterChildAddOrUpdate),t.publish("itemExcluded",{emitFacade:!0,defaultFn:function(e){var t=e.item,n=t.get("contentBox"),r=n.one("ul.separated .action-change");n.addClass(t.getClassName("excluded")),r.setAttribute("tabindex","-1")}}),t.publish("itemIncluded",{emitFacade:!0,defaultFn:function(e){var t=e.item,n=t.get("contentBox"),r=n.one("ul.separated .action-change");n.removeClass(t.getClassName("excluded")),r.removeAttribute("tabindex")}}),t.get("contentBox").delegate("click",function(n){var r=this.get("changeHandler"),i=n.target.ancestor(function(e){return e.hasClass("ohp-repeating-list-item-content")}),s,o;n.preventDefault(),t.each(function(e){e.get("contentBox")===i&&(s=e)});if(!s||!i)return;n.target.hasClass("action-change")&&!i.hasClass(t.getClassName("item-excluded"))&&r?(o=e.bind(r,s),o()):n.target.hasClass("action-exclude")?t.fire("itemExcluded",{item:s}):n.target.hasClass("action-include")&&t.fire("itemIncluded",{item:s})},"ul.separated a",this)},_afterRender:function(){var e=this.get("host");e.each(function(t){this._insertChangeExcludeLinks(e,t.get("contentBox"))},this)},_afterChildAddOrUpdate:function(t){var n=t.child.get("contentBox");e.later(0,this,function(){this._insertChangeExcludeLinks(t.target,n)})},_insertChangeExcludeLinks:function(t,r){var i=e.substitute('<ul class="separated"><li><a href="#" class="action-change">{change}</a></li><li><a href="#" class="action-exclude">{exclude}</a><a href="#" class="action-include">{include}</a></li></ul>',{change:n.get("widget.repeatingList.action.change"),exclude:n.get("widget.repeatingList.action.exclude"),include:n.get("widget.repeatingList.action.include")});r.one(".separated")||r.appendChild(i,"after"),t.triggerReflow()}}),e.namespace("OHP").ChangeExcludeListItemPlugin=r},"7.9.0",{requires:["ohp-locale-translations","ohp-locale-base","arraylist","substitute","event-custom","node-event-delegate","event-base","plugin","oop","yui-later","node-base"]});
