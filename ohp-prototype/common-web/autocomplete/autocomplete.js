/*
 * Copyright (c) Orchestral Developments Ltd (2001 - 2014).
 *
 * This document is copyright. Except for the purpose of fair reviewing, no part
 * of this publication may be reproduced or transmitted in any form or by any
 * means, electronic or mechanical, including photocopying, recording, or any
 * information storage and retrieval system, without permission in writing from
 * the publisher. Infringers of copyright render themselves liable for
 * prosecution.
 */
YAHOO.namespace("ORCHESTRAL.widget"),function(){function f(e,t,n,r,i,s){return e.replace(new RegExp(t,"g"+(n?"":"i")),function(e,t,n,o){return s?(t?"":n.charAt(0))+r+(t?t:o)+i:r+e+i})}function l(e,n,r,i,s){var u,a;if(!s)e=f(e,(i?"":"^")+o(n),r,"<strong>","</strong>",!1);else{u=n.split(new RegExp("[^"+t+"]+"));for(a=0;a<u.length;a+=1){if(u[a]=="")continue;e=f(e,"(^"+o(u[a])+")|([^"+t+"]("+o(u[a])+"))",r,"<<<",">>>",!0)}e=e.replace(/<<</g,"<strong>").replace(/>>>/g,"</strong>")}return"<div>"+e+"</div>"}function c(e){return parseInt(n.getComputedStyle(e,"height"),10)+parseInt(n.getStyle(e,"padding-top"),10)+parseInt(n.getStyle(e,"padding-bottom"),10)}var e=YAHOO.lang,t="A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f3\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bc0-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u24b6-\u24e9\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005\u303b\u303c\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790\ua791\ua7a0-\ua7a9\ua7fa-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uffa0-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc",n=YAHOO.util.Dom,r=YAHOO.util.Event,i=ORCHESTRAL.util.Locale,s=YAHOO.util.KeyListener.KEY,o=ORCHESTRAL.lang.escapeRegex,u,a;u=Date.now||function(){return(new Date).getTime()},a=function(t,o,f,h){if(!n.get(t))return;h=e.merge({autoHighlight:!0,useIFrame:ORCHESTRAL.env.ua.ie&&ORCHESTRAL.env.ua.ie<8,useShadow:!1,animVert:!1,queryDelay:.5,formatResult:function(e,t,n){return l(n,t,this.queryMatchCase,this.queryMatchContains,!1)}},h||{}),h.formatResult=h.formatter||h.formatResult,this._freeText=null,this._lastKeyDownCode=null,this._requestInProgress=!1,this._resultDisplayWindow=h.resultDisplayWindow||10,this._submitInput=n.get(h.submitInput),this._togglingFocus=!1,this._noMatchText=null,this.allowFreeText=!1;var p,d,v;a.superclass.constructor.call(this,t,o,f,h),t=this.getInputEl(),this.forceSelection&&this._submitInput&&this._submitInput.value!=""&&(v=YAHOO.lang.JSON.parse(this._submitInput.value),v.isFreeText?(this._freeText=v.text,t.value=v.text):(this._displaySelectedItem(v),t.value=v[this.dataSource.responseSchema.fields[0]])),r.on(t,"paste",function(){e.later(0,this,function(){this._sInitInputValue!==t.value&&this.sendQuery(t.value)})},null,this),this.textboxFocusEvent.subscribe(function(){this.forceSelection&&n.getStyle(t,"display")!="none"&&this.sendQuery(t.value)}),this.dataRequestEvent.subscribe(function(){if(!this.isFocused())return;p=t.value,this._displayLoadingIndicator()}),this._onWindowResizeEvent=function(){this._onWindowResizeHideResultsList()},r.on(window,"resize",this._onWindowResizeEvent,this,!0),this.containerExpandEvent.subscribe(function(){var e=[n.getX(t),n.getY(t)+t.offsetHeight],r=this._elBody,i=this._elContent,s=n.getDocumentScrollTop(),o,a,f;this._containerExpandedAt=u(),n.setXY(this.getContainerEl(),e),n.setXY(i,e)
,n.setStyle(this.getContainerEl(),"width",t.offsetWidth+"px"),a=this.getListEl().childNodes,n.setStyle(i,"height","auto"),!a[this._resultDisplayWindow]||a[this._resultDisplayWindow].style.display=="none"?(n.setStyle(i,"overflow-y","hidden"),n.setStyle(r,"height","auto")):(n.setStyle(i,"overflow-y","scroll"),n.setStyle(i,"height",n.getY(a[this._resultDisplayWindow])-n.getY(a[0])+"px"),r.scrollTop=0),e[1]+i.offsetHeight>s+d&&(n.setStyle(i,"overflow-y","scroll"),a[1]?o=c(a[0])+c(a[1]):o=c(i),n.setStyle(i,"height",Math.max(o,s+d-(e[1]+2))+"px")),this.useIFrame&&(f=this._elIFrame,f.style.display="block",n.setXY(f,e),n.setStyle(f,"height",i.offsetHeight+"px"),n.setStyle(f,"width",i.offsetWidth+"px"))}),this.itemSelectEvent.subscribe(function(e,n){var r=n[2],i;if(h.onItemSelect){i={control:this,input:t,result:r,searchText:p};if(h.onBeforeItemSelect&&h.onBeforeItemSelect(i)===!1)return;if(h.beforeItemSelect&&h.beforeItemSelect(i.result[1],i.input,i.searchText)===!1)return;h.onItemSelect(i)}this.forceSelection&&this._submitInput&&(this._submitInput.value=YAHOO.lang.JSON.stringify(r),this._displaySelectedItem(r))}),this.doBeforeLoadData=function(e,o){return d=n.getViewportHeight(),this._requestInProgress=!1,this.setHeader(null),this.forceSelection?(this.allowFreeText&&(this.setFooter('<a href="#" tabIndex="-1">'+i.get("widget.autocomplete.useFreeText")+"</a>"),r.on(this._elFooter.firstChild,"click",function(e){this._selectFreeText(),this.collapseContainer(),t.focus(),r.preventDefault(e)},null,this),(new YAHOO.util.KeyListener(this._elFooter.firstChild,{keys:s.UP},{fn:function(){t.focus(),this._nDisplayedItems>0&&this._toggleHighlight(this.getListEl().childNodes[this._nDisplayedItems-1],"to")},scope:this,correctScope:!0})).enable(),(new YAHOO.util.KeyListener(this._elFooter.firstChild,{keys:s.TAB},{fn:function(){this._clearSelection(),this.collapseContainer()},scope:this,correctScope:!0})).enable()),o.results.length===0?(this._noMatchText=t.value,this.setHeader(i.get("widget.autocomplete.noMatches")),!1):(this._noMatchText=null,!0)):!0}},e.extend(a,YAHOO.widget.AutoComplete,{destroy:function(){r.removeListener(window,"resize",this._onWindowResizeEvent),a.superclass.destroy.call(this)},_clearSelection:function(){if(!this.forceSelection||!this.allowFreeText){this._submitInput&&(this._submitInput.value=""),a.superclass._clearSelection.call(this);return}!this._requestInProgress&&this.getInputEl().value.length>=this.minQueryLength&&this._nDisplayedItems===0&&this._selectFreeText(),this.getInputEl().value!=this._freeText&&(this._freeText=null,this._submitInput&&(this._submitInput.value=""),a.superclass._clearSelection.call(this))},_displayLoadingIndicator:function(){this.setHeader('<div class="yui-ac-loading">&nbsp;</div>'),this.setFooter(null),this.clearList(),this.expandContainer()},_displaySelectedItem:function(t){var o=this.getInputEl(),u=o.offsetHeight,a,f;n.setStyle(o,"display","none"),a=document.createElement("a"),a.href="#",a.innerHTML=i.get("widget.autocomplete.change"),f=document.createElement("span"),f.innerHTML=this.formatSelectedResult(t)+" ",f.appendChild(a),n.insertAfter(f,o),n.setStyle(f,"display","inline-block"),n.setStyle(f,"min-height",u+"px"),this._lastKeyDownCode==s.TAB?(a.tabIndex=-1,e.later(0,null,function(){a.tabIndex=null})):this._lastKeyDownCode&&e.later(0,null,function(){a.focus()}),r.on(a,"click",function(e){r.purgeElement(a),o.parentNode.removeChild(n.getNextSibling(o)),n.setStyle(o,"display","inline"),o.select(),this.sendQuery(o.value),r.preventDefault(e)},null,this)},_moveSelection:function(e){if(this.forceSelection&&this.allowFreeText&&e==s.DOWN){var t=this._elCurListItem;if(t&&this.getListItemIndex(t)+1>=this._nDisplayedItems){this._togglingFocus=!0,this._toggleHighlight({}),this._elFooter.firstChild.focus();return}}a.superclass._moveSelection.call(this,e)},_onTextboxBlur:function(e,t){if(t._togglingFocus)return t._togglingFocus=!1,!1;a.superclass._onTextboxBlur.call(this,e,t)},_onTextboxKeyDown:function(e,t){switch(e.keyCode){case s.LEFT:case s.RIGHT:case s.HOME:case s.END:t.textboxKeyEvent.fire(t,e.keyCode);break;case s.DOWN:if(t.forceSelection&&t.allowFreeText&&t.isContainerOpen()&&!t._requestInProgress&&t._nDisplayedItems===0){t.togglingFocus=!0,t._elFooter.firstChild.focus();break}t._lastKeyDownCode=e.keyCode,a.superclass._onTextboxKeyDown.call(this,e,t);break;default:t._lastKeyDownCode=e.keyCode,a.superclass._onTextboxKeyDown.call(this,e,t)}},_onTextboxKeyUp:function(e,t){var n,r;if(t._isIgnoreKey(e.keyCode))return;n=this.value;if(n&&n.length<t.minQueryLength||!n&&t.minQueryLength>0){t._nDelayID!=-1&&clearTimeout(t._nDelayID),t.collapseContainer();return}r=t.getInputEl().value;if(t._noMatchText&&r.indexOf(t._noMatchText)===0){t._noMatchText=r;return}t._noMatchText=null,t._requestInProgress=!0,t._displayLoadingIndicator(),a.superclass._onTextboxKeyUp.call(this,e,t)},_selectItem:function(e){this._freeText=null,a.superclass._selectItem.call(this,e)},_selectFreeText:function(){this._freeText=this.getInputEl().value,this._submitInput.value=YAHOO.lang.JSON.stringify({isFreeText:!0,text:this._freeText})},_onWindowResizeHideResultsList:function(){this._hidingBecauseOfResize=!0,(!this._containerExpandedAt||u()-200>this._containerExpandedAt)&&this.collapseContainer()},formatSelectedResult:null}),a.WORD_MATCH_HIGHLIGHT_FORMATTER=function(e,t,n){return l(n,t,!1,!0,!0)},ORCHESTRAL.widget.AutoComplete=a}(),YAHOO.register("orchestral-autocomplete",ORCHESTRAL.widget.AutoComplete,{version:"7.9",build:"0"});
