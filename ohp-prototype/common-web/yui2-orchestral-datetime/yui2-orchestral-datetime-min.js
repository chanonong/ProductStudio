/*
 * Copyright (c) Orchestral Developments Ltd (2001 - 2014).
 *
 * This document is copyright. Except for the purpose of fair reviewing, no part
 * of this publication may be reproduced or transmitted in any form or by any
 * means, electronic or mechanical, including photocopying, recording, or any
 * information storage and retrieval system, without permission in writing from
 * the publisher. Infringers of copyright render themselves liable for
 * prosecution.
 */
YUI.add("yui2-orchestral-datetime",function(e,t){
/*!(C) ORCHESTRAL*/
var n=e.YUI2,r=n.ORCHESTRAL;n.namespace("ORCHESTRAL.util"),function(){var t=n.lang,i=n.widget.DateMath,s=n.util.Dom,o=n.util.Event,u=r.util.Locale;r.util.DateFormat=function(e){this._format=e};var a=r.util.DateFormat;a.prototype={format:function(e){if(e===null)return"";var t=this._format,n=[],r=function(e){return n[n.length]=e,"~"+(n.length-1)+"~"};t=t.replace(/'([^']+)'/g,function(e){return r(e.slice(1,-1))}),t=t.replace("''","'"),t=t.replace(/y{4,}/g,e.getFullYear()),t=t.replace(/y{1,3}/g,this._pad(e.getFullYear()%100)),t=t.replace(/M{4,}/g,r(u.get("util.date.months.long")[e.getMonth()])),t=t.replace(/M{3}/g,r(u.get("util.date.months.short")[e.getMonth()])),t=t.replace(/M{2}/g,this._pad(e.getMonth()+1)),t=t.replace(/M/g,e.getMonth()+1),t=t.replace(/d{2,}/g,this._pad(e.getDate())),t=t.replace(/d/g,e.getDate()),t=t.replace(/E{4,}/g,r(u.get("util.date.day.long")[e.getDay()])),t=t.replace(/E{1,3}/g,r(u.get("util.date.day.short")[e.getDay()])),t=t.replace(/a+/g,r(u.get("util.date."+(e.getHours()<12?"am":"pm")))),t=t.replace(/H{2,}/g,this._pad(e.getHours())),t=t.replace(/H/g,e.getHours()),t=t.replace(/h{2,}/g,this._pad(this._halfDay(e.getHours()))),t=t.replace(/h/g,this._halfDay(e.getHours())),t=t.replace(/m{2,}/g,this._pad(e.getMinutes())),t=t.replace(/m/g,e.getMinutes()),t=t.replace(/s{2,}/g,this._pad(e.getSeconds())),t=t.replace(/s/g,e.getSeconds());for(var i=0;i<n.length;i++)t=t.replace(new RegExp("~"+i+"~","g"),n[i]);return t},_pad:function(e){return e+="",(e.length==1?"0":"")+e},_halfDay:function(e){return(e+11)%12+1}},a.ISO_8601_DATE=new a("yyyy-MM-dd"),a.ISO_8601_DATE.parse=function(e){var t=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);return t===null?null:new Date(+t[1],+t[2]-1,+t[3])},a.ISO_8601_TIME=new a("HH:mm:ss"),a.ISO_8601_TIME.parse=function(e){var t=e.match(/^(\d{2}):(\d{2}):(\d{2})$/);return t===null?null:new Date(0,0,0,+t[1],+t[2],+t[3])},a.ISO_8601_DATE_TIME=new a("yyyy-MM-dd'T'HH:mm:ss"),a.ISO_8601_DATE_TIME.parse=function(e){var t=e.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})$/);return t===null?null:new Date(+t[1],+t[2]-1,+t[3],+t[4],+t[5],+t[6])},a.SHORT_DATE=new a(u.get("widget.datetime.short.date.format")),a.SHORT_TIME=new a(u.get("widget.datetime.short.time.format")),a.SHORT_DATE_TIME=new a(u.get("widget.datetime.short.datetime.format")),a.MEDIUM_DATE=new a(u.get("widget.datetime.medium.date.format")),a.MEDIUM_TIME=new a(u.get("widget.datetime.medium.time.format")),a.MEDIUM_DATE_TIME=new a(u.get("widget.datetime.medium.datetime.format")),a.LONG_DATE=new a(u.get("widget.datetime.long.date.format")),a.LONG_TIME=new a(u.get("widget.datetime.long.time.format")),a.LONG_DATE_TIME=new a(u.get("widget.datetime.long.datetime.format"));var f=function(e,t){this.year=e,this.month=t};f._YEAR_DISPLAY_FORMAT=new a(u.get("widget.datetime.medium.year.format")),f._YEAR_MONTH_DISPLAY_FORMAT=new a(u.get("widget.datetime.medium.yearmonth.format")),f.parse=function(e){var t=e.match(/^(\d{4})-(\d{2})$/);return t!==null?new f(+t[1],+t[2]):(t=e.match(/^(\d{4})$/),t!==null?new f(+t[1]):null)},f.prototype={formatDisplay:function(){return this._formatDate(f._YEAR_DISPLAY_FORMAT,f._YEAR_MONTH_DISPLAY_FORMAT)},formatISO:function(){return this._formatDate(new a("yyyy"),new a("yyyy-MM"))},_formatDate:function(e,t){return this.month?t.format(new Date(this.year,this.month-1,1)):e.format(new Date(this.year,0,1))}};var l=function(e){this.value=e};n.namespace("ORCHESTRAL.widget"),r.widget.Date=function(e){return e=s.get(e),s.addClass(e,"OrchestralDate"),new r.widget.DateTime(e)},r.widget.PartialDate=function(e){return e=s.get(e),s.addClass(e,"OrchestralPartialDate"),new r.widget.DateTime(e)},r.widget.Time=function(e){return e=s.get(e),s.addClass(e,"OrchestralTime"),new r.widget.DateTime(e)},r.widget.DateRange=function(e,t){this._from=new r.widget.Date(e),this._to=new r.widget.Date(t),this._from.setMax(s.get(t).value),this._to.setMin(s.get(e).value),this._from.subscribe("dateChanged",function(e){this._to.setMin(e.value)},this,!0),this._to.subscribe("dateChanged",function(e){this._from.setMax(e.value)},this,!0)},r.widget.DateRange.prototype={_from:null,_to:null,isValid:function(){return this._from.isValid()&&this._to.isValid()},addClass:function(e){this._from.addClass(e),this._to.addClass(e)},removeClass:function(e){this._from.removeClass(e),this._to.removeClass(e)},setAttribute:function(e,t){this._from.setAttribute(e,t),this._to.setAttribute(e,t)},removeAttribute:function(e){this._from.removeAttribute(e),this._to.removeAttribute(e)}},r.widget.DateTime=function(i){var a=r.util.Registry;if(a.get("ORCHESTRAL.widget.DateTime",i))return a.get("ORCHESTRAL.widget.DateTime",i);this._initialised=!1,this._hiddenInput=s.get(i),this._lastSeenHiddenInputValue=null,this._dateInput=null,this._timeInput=null,this._date=null,this._time=null,this.dateTimeChangedEvent=this.createEvent("dateTimeChanged"),this.timeChangedEvent=this.createEvent("timeChanged"),this.dateChangedEvent=this.createEvent("dateChanged"),this._min=null,this._max=null,this._isPartialDateInput=s.hasClass(this._hiddenInput,"OrchestralPartialDate"),this._isDateInput=s.hasClass(this._hiddenInput,"OrchestralDate")||this._isPartialDateInput,this._isTimeInput=s.hasClass(this._hiddenInput,"OrchestralTime"),!this._isDateInput&&!this._isTimeInput&&s.addClass(this._hiddenInput,"OrchestralDateTime"),this._isDateTimeInput=s.hasClass(this._hiddenInput,"OrchestralDateTime");var f=document.createElement("nobr"),l=this._hiddenInput.nextSibling;l?this._hiddenInput.parentNode.insertBefore(f,l):this._hiddenInput.parentNode.appendChild(f);var c=this._hiddenInput.getAttribute("aria-label"),h=function(e,t){c&&(this._isDateTimeInput?e.setAttribute("aria-label",u.get(t,c)):e.setAttribute("aria-label",c))};if(this._isDateInput||this._isDateTimeInput){this._dateInput=document.createElement("input"),this._dateInput.setAttribute("type"
,"text"),this._dateInput.setAttribute("size","11"),this._dateInput.className="medium",h.call(this,this._dateInput,"cow.datetime.label.screenReader.date"),f.appendChild(this._dateInput);var p=document.createElement("a");p.setAttribute("href","#"),p.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;",p.tabIndex=-1,f.appendChild(p),s.addClass(p,"OrchestralDatePicker"),o.on(p,"click",function(n,i){if(!s.hasClass(p,"disabled")){var a=s.getViewportHeight(),f=s.getViewportWidth(),l=s.get("OrchestralCalendar"),c=r.widget.DateTime._createCalendar(l,i.control);l.style.visibility="hidden",l.style.display="block";var h,d=s.getY(i.input),v=i.input.offsetHeight;d+v+l.offsetHeight-s.getDocumentScrollTop()<a?h=d+v:l.offsetHeight<d-s.getDocumentScrollTop()?h=d-l.offsetHeight:h=-1;var m,g=s.getX(i.input),y=s.getX(this),b=this.offsetWidth;g+l.offsetWidth-s.getDocumentScrollLeft()<f?m=g:l.offsetWidth<y-s.getDocumentScrollLeft()+b?m=y+b-l.offsetWidth:l.offsetWidth<f?m=f-l.offsetWidth:m=-1;var w=function(e){i.input.value=r.widget.DateTime._DATE_DISPLAY_FORMAT.format(e),i.control._handleUserDateUpdate(),i.input.select()};if(m!=-1&&h!=-1){c.selectEvent.subscribe(function(){l.style.visibility="hidden",w(c.getSelectedDates().pop())});var E=s.getAncestorBy(this,function(e){if(s.hasClass(e,"yui-panel"))return!1;var t=s.getStyle(e,"z-index");return t!==0&&t!="auto"});l.style.zIndex=E?s.getStyle(E,"z-index"):0,l.style.visibility="visible",s.setXY(l,[m,h])}else{c.cfg.setProperty("title",!1),c.cfg.setProperty("close",!1);var S,x=l.offsetHeight,T=l.offsetWidth,N=r.COMMON_WEB_CONTEXT+"/datetime/assets/calendar.html";c.cfg.setProperty("title",!0),c.cfg.setProperty("close",!0);for(var C=0;C<document.styleSheets.length;C++){var k=document.styleSheets[C];if(!k.disabled&&k.href&&(k.href.indexOf("assets/skins/hive")!=-1||k.href.indexOf("assets/skins/orchestral")!=-1)){N+="?skin="+function(){var e=k.href.split("/");return e[e.length-2]}();break}}l.style.display="none",r.widget.DateTime._popupConfig={activeControl:i.control,title:u.get("widget.datetime.calendar.title")},typeof e!="undefined"&&e.YUI2&&(window.ORCHESTRAL_DATETIME_POPUP_CONFIG=r.widget.DateTime._popupConfig);var L=function(){var e=0,n=0,r,i;return t.isUndefined(window.screenTop)?(e=screenY+(outerHeight-x)/2,n=screenX+(outerWidth-T)/2):window.top.document?(r=window.top.document,i=r.compatMode!="CSS1Compat"?r.body:r.documentElement,e=window.top.screenTop+(i.clientHeight-x)/2,n=window.top.screenLeft+(i.clientWidth-T)/2):(e=0,n=0),{top:e,left:n}}(),A=new Window(N,w,T,x,"Calendar",L);A.open(),o.on(window,"unload",A.close,null,A)}}o.stopEvent(n)},{input:this._dateInput,control:this}),o.on(this._dateInput,"blur",function(e){this._handleUserDateUpdate()},this,!0),(new n.util.KeyListener(this._dateInput,{keys:n.util.KeyListener.KEY.ENTER},{fn:function(e){this._handleUserDateUpdate()},scope:this,correctScope:!0})).enable()}f.childNodes.length>0&&f.appendChild(document.createTextNode(" "));if(this._isTimeInput||this._isDateTimeInput){this._timeInput=document.createElement("input"),this._timeInput.setAttribute("type","text"),this._timeInput.setAttribute("size","6"),this._timeInput.className="small",h.call(this,this._timeInput,"cow.datetime.label.screenReader.time");var d=document.createElement("span");d.className="orchestral-time-indicator",d.tabindex="-1",d.appendChild(document.createTextNode(" ")),this._isDateTimeInput&&(this._timeInput.className="small"),f.appendChild(this._timeInput),f.appendChild(d),o.on(this._timeInput,"blur",function(e){this._handleUserTimeUpdate()},this,!0),(new n.util.KeyListener(this._timeInput,{keys:n.util.KeyListener.KEY.ENTER},{fn:function(e){this._handleUserTimeUpdate()},scope:this,correctScope:!0})).enable()}this.setMin(this._hiddenInput.getAttribute("min")),this.setMax(this._hiddenInput.getAttribute("max")),this._updateView(),this._lastSeenHiddenInputValue=this._hiddenInput.value,this._dateInput&&(this._dateInput.defaultValue=this._dateInput.value),this._timeInput&&(this._timeInput.defaultValue=this._timeInput.value);var v=this;setInterval(function(){v._updateView()},r.widget.DateTime._POLLING_INTERVAL),this._hiddenInput.tabIndex=-1,o.on(this._hiddenInput,"focus",function(e){try{(this._isTimeInput?this._timeInput:this._dateInput).focus()}catch(t){}},this,!0),this._initialised=!0,a.put("ORCHESTRAL.widget.DateTime",this._hiddenInput,this)},r.widget.DateTime._enhanceMarkup=function(){if(window.ORCHESTRAL_DATETIME_MARKUP_ENHANCED||r.widget.DateTime._markupEnhanced)return;r.widget.DateTime._markupEnhanced=!0,typeof e!="undefined"&&e.YUI2&&(window.ORCHESTRAL_DATETIME_MARKUP_ENHANCED=r.widget.DateTime._markupEnhanced);var t=["OrchestralDate","OrchestralPartialDate","OrchestralTime","OrchestralDateTime"];for(var i=0;i<t.length;i++){var u=s.getElementsByClassName(t[i],"input");for(var a=0;a<u.length;a++)new r.widget.DateTime(u[a])}var f=document.createElement("div");f.id="OrchestralCalendar",f.style.display="none",f.style.position="absolute",document.body.appendChild(f);var l=function(e){f.style.display="none"};(new n.util.KeyListener(document,{keys:n.util.KeyListener.KEY.ESCAPE},{fn:l,scope:this,correctScope:!0})).enable(),o.on(document,"click",function(e){var t=o.getTarget(e);t!=f&&!s.isAncestor(f,t)&&l()})},r.widget.DateTime.get=function(e){return r.widget.DateTime._enhanceMarkup(),r.util.Registry.get("ORCHESTRAL.widget.DateTime",s.get(e))},r.widget.DateTime._createCalendar=function(e,t){var l=null,c=new n.widget.Calendar(e,{close:!0,title:u.get("widget.datetime.calendar.title"),LOCALE_MONTHS:"long",LOCALE_WEEKDAYS:"medium",MONTHS_SHORT:u.get("util.date.months.short"),MONTHS_LONG:u.get("util.date.months.long"),MULTI_SELECT:!1,START_WEEKDAY:u.get("widget.datetime.calendar.startDayOfWeek"),WEEKDAYS_MEDIUM:r.widget.DateTime._CALENDAR_WEEKDAYS});try{l=a.ISO_8601_DATE.parse(t._hiddenInput.value.substr(0,10)),!l&&t._isPartialDateInput&&(l=f.parse(t._hiddenInput.value))}catch(h){}return l instanceof f?(c.setMonth(l.month?l.month-1:0),c.setYear(l.year)):(l instanceof Date?c
.select(l):(l=new Date,t._min&&i.before(l,t._min)&&(l=t._min),t._max&&i.after(l,t._max)&&(l=t._max)),c.setMonth(l.getMonth()),c.setYear(l.getFullYear())),c.cfg.setProperty("mindate",t._min?new Date(t._min):null),c.cfg.setProperty("maxdate",t._max?new Date(t._max):null),c.renderEvent.subscribe(function(e,t,n){o.on("calmonth","change",function(e){n.setMonth(+s.get("calmonth").value),n.render()},n),o.on("calyear","change",function(e){n.setYear(+s.get("calyear").value),n.render()},n),o.on("headernavleft","click",function(e){o.preventDefault(e),setTimeout(function(){n.previousMonth(),s.get("headernavleft").focus()},0)},n,!0),o.on("headernavright","click",function(e){o.preventDefault(e),setTimeout(function(){n.nextMonth(),s.get("headernavright").focus()},0)},n,!0)},c),c.buildMonthLabel=function(){var e=this.Locale.LOCALE_MONTHS,t=this.cfg.getProperty("pagedate"),n=this.cfg.getProperty("mindate"),r=this.cfg.getProperty("maxdate"),i=Math.min(n===null?(new Date).getFullYear()-100:n.getFullYear(),t.getFullYear()),s=Math.max(r===null?(new Date).getFullYear()+2:r.getFullYear(),t.getFullYear()),o='<a href="#" id="headernavleft">&nbsp;</a>';o+='<select id="calmonth">';for(var u=0;u<e.length;u++)o+='<option value="'+u+'"'+(t.getMonth()==u?' selected="selected"':"")+">"+e[u]+"</option>";o+='</select><select id="calyear">';for(var a=s;a>=i;a--)o+='<option value="'+a+'"'+(a==t.getFullYear()?' selected="selected"':"")+">"+a+"</option>";return o+="</select>",o+='<a href="#" id="headernavright">&nbsp;</a>',o},c.render(),s.getElementsByClassName("calheader","div",c.oDomContainer,function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];n.nodeType==3&&n.parentNode.removeChild(n)}}),c},r.widget.DateTime._updateErrorStyling=function(e){s[s.hasClass(e,"OrchestralDateTimeRangeError")||s.hasClass(e,"OrchestralDateTimeInvalidValueError")?"addClass":"removeClass"](e,"ohp-date-time-invalid-error")},r.widget.DateTime._popupConfig=null,r.widget.DateTime._CALENDAR_WEEKDAYS=function(){return u.get("cow.datetime.label.calendar.dayColumnHeaders")}(),r.widget.DateTime._DATE_TIME_DISPLAY_FORMAT=a.MEDIUM_DATE_TIME,r.widget.DateTime._DATE_DISPLAY_FORMAT=a.MEDIUM_DATE,r.widget.DateTime._TIME_DISPLAY_FORMAT=a.MEDIUM_TIME,r.widget.DateTime._POLLING_INTERVAL=500,r.widget.DateTime.prototype={_DISPLAY_FORMAT_ENDS_WITH_YEAR:function(){var e=t.trim(r.widget.DateTime._DATE_DISPLAY_FORMAT._format);return e.charAt(e.length-1).toLowerCase()=="y"}(),_DAYS_FIRST:u.get("widget.datetime.display.daysBeforeMonths"),setMin:function(e){e&&!this._isPartialDateInput?this._isDateInput||this._isDateTimeInput&&e.length==10?this._min=a.ISO_8601_DATE.parse(e):this._isTimeInput?this._min=a.ISO_8601_TIME.parse(e):this._min=a.ISO_8601_DATE_TIME.parse(e):this._min=null,this._updateTooltip(),this._validateRanges()},setMax:function(e){e&&!this._isPartialDateInput?this._isDateInput?this._max=a.ISO_8601_DATE.parse(e):this._isTimeInput?this._max=a.ISO_8601_TIME.parse(e):this._max=a.ISO_8601_DATE_TIME.parse(e+(e.length==10?"T23:59:59":"")):this._max=null,this._updateTooltip(),this._validateRanges()},isValid:function(){var e=this._timeInput&&s.hasClass(this._timeInput,"OrchestralDateTimeInvalidValueError")||this._timeInput&&s.hasClass(this._timeInput,"OrchestralDateTimeRangeError")||s.hasClass(this._dateInput,"OrchestralDateTimeInvalidValueError")||s.hasClass(this._dateInput,"OrchestralDateTimeRangeError");return!e},addClass:function(e){this._dateInput&&s.addClass(this._dateInput,e),this._timeInput&&s.addClass(this._timeInput,e)},removeClass:function(e){this._dateInput&&s.removeClass(this._dateInput,e),this._timeInput&&s.removeClass(this._timeInput,e)},setAttribute:function(e,t){var n=e==="disabled"?!0:!1;this._dateInput&&(this._dateInput.setAttribute(e,t),n&&s.addClass(this._dateInput.nextSibling,"disabled")),this._timeInput&&(this._timeInput.setAttribute(e,t),n&&s.addClass(this._timeInput.nextSibling,"disabled"))},removeAttribute:function(e){var t=e==="disabled"?!0:!1;this._dateInput&&(this._dateInput.removeAttribute(e),t&&s.removeClass(this._dateInput.nextSibling,"disabled")),this._timeInput&&(this._timeInput.removeAttribute(e),t&&s.removeClass(this._timeInput.nextSibling,"disabled"))},setValue:function(e){e=e||"",this._lastSeenHiddenInputValue=e?"":"force_update",this._hiddenInput.value=e,this._updateView()},_handleUserDateUpdate:function(){this._dateInput.value=t.trim(this._dateInput.value);var e=this._parseDate(this._dateInput.value);!e&&this._isPartialDateInput&&(e=this._parsePartialDate(this._dateInput.value)),e||(e=this._dateInput.value==""?null:new l(this._dateInput.value)),this._updateDate(e),this._isDateTimeInput&&(this._date instanceof Date&&this._timeInput.value==""&&(this._min&&this._getDate(this._date).getTime()==this._getDate(this._min).getTime()?this._timeInput.value=this._min.getHours()+":"+this._min.getMinutes():this._timeInput.value="00:00"),this._handleUserTimeUpdate())},_updateDate:function(e,t){var n=this._date;this._date=e,s[e instanceof l?"addClass":"removeClass"](this._dateInput,"OrchestralDateTimeInvalidValueError"),r.widget.DateTime._updateErrorStyling(this._dateInput);var i;return e instanceof Date?(this._dateInput.value=r.widget.DateTime._DATE_DISPLAY_FORMAT.format(e),i=!(n instanceof Date)||n.getTime()!=e.getTime()):e instanceof f?(this._dateInput.value=e.formatDisplay(),i=!(n instanceof f)||n.year!=e.year||n.month!=e.month):e instanceof l?(this._dateInput.value=e.value,i=!(n instanceof l)||n.value!=e.value):(this._dateInput.value="",i=n!==null),this._validateRanges(),this._updateHiddenInput(),i&&this._initialised&&(this.dateChangedEvent.fire(this._hiddenInput),t||this.dateTimeChangedEvent.fire(this._hiddenInput)),i},_handleUserTimeUpdate:function(){this._timeInput.value=t.trim(this._timeInput.value);var e=this._parseTime(this._timeInput.value);e||(e=this._timeInput.value==""?null:new l(this._timeInput.value)),this._updateTime(e)},_updateTime:function(e,t){var n=this._time;this._time=e,s[e instanceof l?"addClass":"removeClass"
](this._timeInput,"OrchestralDateTimeInvalidValueError"),r.widget.DateTime._updateErrorStyling(this._timeInput),this._isDateTimeInput&&this._date===null&&(s[e!==null?"addClass":"removeClass"](this._dateInput,"OrchestralDateTimeInvalidValueError"),r.widget.DateTime._updateErrorStyling(this._dateInput));var i;return e instanceof Date?(this._timeInput.value=r.widget.DateTime._TIME_DISPLAY_FORMAT.format(e),i=!(n instanceof Date)||n.getTime()!=e.getTime()):e instanceof l?(this._timeInput.value=e.value,i=!(n instanceof l)||n.value!=e.value):(this._timeInput.value="",i=n!==null),this._validateRanges(),this._updateHiddenInput(),i&&this._initialised&&(this.timeChangedEvent.fire(this._hiddenInput),t||this.dateTimeChangedEvent.fire(this._hiddenInput)),i},_parseDate:function(e){if(/^\d{8}$/.test(e))return this._validateDate(e.substr(this._DAYS_FIRST?0:2,2),e.substr(this._DAYS_FIRST?2:0,2),e.substr(4));var t=this._splitDateParts(e);return t.length!=3?null:isNaN(t[0])?this._validateDate(t[1],t[0],t[2]):+t[0]>31?this._validateDate(t[2],t[1],t[0]):+t[2]>31||this._DISPLAY_FORMAT_ENDS_WITH_YEAR?+t[0]>12||isNaN(t[1])?this._validateDate(t[0],t[1],t[2]):+t[1]>12?this._validateDate(t[1],t[0],t[2]):this._validateDate(t[this._DAYS_FIRST?0:1],t[this._DAYS_FIRST?1:0],t[2]):this._validateDate(t[2],t[1],t[0])},_parsePartialDate:function(e){var t=this._splitDateParts(e);return t.length==1?this._validatePartialDate(t[0]):t.length==2?+t[0]>12||isNaN(t[1])?this._validatePartialDate(t[0],t[1]):+t[1]>12||isNaN(t[0])?this._validatePartialDate(t[1],t[0]):this._validatePartialDate(t[this._DISPLAY_FORMAT_ENDS_WITH_YEAR?1:0],t[this._DISPLAY_FORMAT_ENDS_WITH_YEAR?0:1]):null},_splitDateParts:function(e){var t=e.split(/\.?\s*[\-\.\/ ]\s*/),n=[];for(var r=0;r<t.length;r++)t[r]!=""&&n.push(t[r]);return n},_validateDate:function(e,t,n){if(!e||!t||!n)return null;e=+e;if(isNaN(e)||e===0||e>31)return null;n=this._normaliseYear(n),t=this._normaliseMonth(t);if(!n||!t)return null;var r=new Date(n,t-1,e);return r.getMonth()!=t-1?null:r},_validatePartialDate:function(e,t){e=this._normaliseYear(e);if(!e)return null;if(t){t=this._normaliseMonth(t);if(!t)return null}return t?new f(e,t):new f(e)},_normaliseYear:function(e){var t=e.length;return t!=2&&t!=4?null:(e=+e,isNaN(e)?null:(t==2&&(e+=e>50?1900:2e3),e))},_normaliseMonth:function(e){return isNaN(e)&&(e=this._getMonthFromText(e)),e=+e,e<1||e>12?null:e},_getMonthFromText:function(){var e=function(e){var t=u.get("util.date.normalizedChars");for(var n in t)t.hasOwnProperty(n)&&(e=e.replace(n,t[n]));return e.replace(/\.$/,"").toLowerCase()};return function(t){t=e(t);var n,r,i=u.get("util.date.months.long"),s=u.get("util.date.months.short");for(r=0;r<i.length;r++)if(t==e(i[r]))return r+1;for(r=0;r<s.length;r++){var o=e(s[r]);if(t==o)return r+1;if(o.indexOf(t)===0||o=="juin"&&t=="jun"||o=="juil"&&t=="jul"){if(!!n)return null;n=r+1}}return n?n:null}}(),_parseTime:function(e){var t=e.match(/^(.*\d)\s*(\D*)$/);if(!t)return null;var n,r,i,s=t[1],o=t[2]||"";if(/^\d{1,2}$/.test(s))n=s,r=0,i=0;else if(/^\d{3}$/.test(s))n=s.charAt(0),r=s.substr(1),i=0;else if(/^\d{4}$/.test(s))n=s.substr(0,2),r=s.substr(2),i=0;else if(/^\d{6}$/.test(s))n=s.substr(0,2),r=s.substr(2,2),i=s.substr(4);else if(/^\d/.test(s)){t=s.match(/^(\d{1,2}) ?h ?(\d{2})$/);if(t&&o=="")n=t[1],r=t[2],i=0;else{var u=s.match(/^(\d+) *[:|\.]? *(\d+) *[:|\.]? *(\d+)?$/);if(!u)return null;n=u[1],r=u[2],i=u[3]||0}}n=+n,r=+r,i=+i;if(isNaN(n)||isNaN(r)||isNaN(i))return null;if(o!=""){if(!/^[ap]\.?m?\.?$/i.test(o))return null;o=o.charAt(0).toLowerCase()}var a=o==""?24:12;return n<0||n>a||r<0||r>59||i<0||i>59?null:n==a&&n==24?r===0&&i===0?new Date(0,0,0,23,59,59):null:(o=="a"&&n==12&&(n-=12),o=="p"&&n!=12&&(n+=12),new Date(0,0,0,n,r,i))},_updateHiddenInput:function(){this._isDateInput&&this._date instanceof l?this._hiddenInput.value=this._dateInput.value:this._isTimeInput&&this._time instanceof l?this._hiddenInput.value=this._timeInput.value:this._date instanceof l||this._time instanceof l?this._hiddenInput.value=t.trim(this._dateInput.value+" "+this._timeInput.value):this._date&&this._time?this._hiddenInput.value=a.ISO_8601_DATE_TIME.format(this._getDateTime(this._date,this._time)):this._date?this._hiddenInput.value=this._date instanceof f?this._date.formatISO():a.ISO_8601_DATE.format(this._date):this._time?this._hiddenInput.value=a.ISO_8601_TIME.format(this._time):this._hiddenInput.value="",this._lastSeenHiddenInputValue=this._hiddenInput.value},_updateTooltip:function(){var e=function(){return""};this._min&&this._max?e=function(e){return t.substitute(u.get("widget.datetime.minmax.hint"),[e.format(this._min),e.format(this._max)])}:this._min?e=function(e){return t.substitute(u.get("widget.datetime.min.hint"),[e.format(this._min)])}:this._max&&(e=function(e){return t.substitute(u.get("widget.datetime.max.hint"),[e.format(this._max)])});if(this._isDateInput)this._dateInput.title=e.call(this,r.widget.DateTime._DATE_DISPLAY_FORMAT);else if(this._isTimeInput)this._timeInput.title=e.call(this,r.widget.DateTime._TIME_DISPLAY_FORMAT);else if(this._isDateTimeInput){var n=e.call(this,r.widget.DateTime._DATE_TIME_DISPLAY_FORMAT);this._dateInput.title=n,this._timeInput.title=n}},_validateRanges:function(){var e=function(e,t){return e.getFullYear()==t.getFullYear()&&e.getMonth()==t.getMonth()&&e.getDate()==t.getDate()},t=function(){s.addClass(this._dateInput,"OrchestralDateTimeRangeError"),s.addClass(this._dateInput,"ohp-date-time-invalid-error")},n=function(){s.addClass(this._timeInput,"OrchestralDateTimeRangeError"),s.addClass(this._timeInput,"ohp-date-time-invalid-error")};return function(){if(this._isPartialDateInput)return;this._isDateInput||(s.removeClass(this._timeInput,"OrchestralDateTimeRangeError"),r.widget.DateTime._updateErrorStyling(this._timeInput)),this._isTimeInput||(s.removeClass(this._dateInput,"OrchestralDateTimeRangeError"),r.widget.DateTime._updateErrorStyling(this._dateInput,"error"));var o=this._date instanceof Date,u=this._time instanceof 
Date;if((this._isDateInput||this._isDateTimeInput)&&!o||this._isTimeInput&&!u)return;var a;this._isTimeInput?a=this._getDateTime(new Date(0,0,0),this._time):this._isDateInput?a=this._getDate(this._date):a=this._getDateTime(this._date,u?this._time:new Date(0,0,0,23,59,59)),this._max&&i.after(a,this._max)&&(this._isDateInput?t.apply(this):this._isTimeInput?n.apply(this):e(a,this._max)?u&&n.apply(this):t.apply(this)),this._isDateTimeInput&&!u&&(a=this._getDate(this._date)),this._min&&i.before(a,this._min)&&(this._isDateInput?i.before(i.clearTime(a),i.clearTime(this._min))&&t.apply(this):this._isTimeInput?n.apply(this):e(a,this._min)?u&&n.apply(this):t.apply(this))}}(),_getDate:function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0)},_getDateTime:function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes(),t.getSeconds())},_updateView:function(){var e=this._hiddenInput.value,t=null,n=null,r,i,s;if(e==this._lastSeenHiddenInputValue)return;this._isDateInput?(t=a.ISO_8601_DATE.parse(e),!t&&this._isPartialDateInput&&(t=f.parse(e)),t||(t=e==""?null:new l(e)),this._updateDate(t)):this._isTimeInput?(n=a.ISO_8601_TIME.parse(e),n||(n=e==""?null:new l(e)),this._updateTime(n)):(e&&(r=a.ISO_8601_DATE_TIME.parse(e),r?(t=new Date(r.getFullYear(),r.getMonth(),r.getDate()),n=new Date(0,0,0,r.getHours(),r.getMinutes(),r.getSeconds())):(t=a.ISO_8601_DATE.parse(e),t||(n=a.ISO_8601_TIME.parse(e),n||(t=new l(e))))),i=this._updateDate(t,!0),s=this._updateTime(n,!0),(i||s)&&this._initialised&&this.dateTimeChangedEvent.fire(this._hiddenInput))}},t.augment(r.widget.Date,n.util.EventProvider),t.augment(r.widget.PartialDate,n.util.EventProvider),t.augment(r.widget.Time,n.util.EventProvider),t.augment(r.widget.DateTime,n.util.EventProvider),o.onDOMReady(function(){r.widget.DateTime._enhanceMarkup()})}(),n.register("orchestral-datetime",r.widget.DateTime,{version:"7.9",build:"0"})},"7.9.0",{requires:["yui2-yahoo","yui2-dom","yui2-event","yui2-calendar","yui2-orchestral","ohp-locale-translations","yui2-legacy-window","yui2-logger"]});
