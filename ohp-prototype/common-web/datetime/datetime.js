/*
 * Copyright (c) Orchestral Developments Ltd (2001 - 2014).
 *
 * This document is copyright. Except for the purpose of fair reviewing, no part
 * of this publication may be reproduced or transmitted in any form or by any
 * means, electronic or mechanical, including photocopying, recording, or any
 * information storage and retrieval system, without permission in writing from
 * the publisher. Infringers of copyright render themselves liable for
 * prosecution.
 */
YAHOO.namespace("ORCHESTRAL.util"),function(){var e=YAHOO.lang,t=YAHOO.widget.DateMath,n=YAHOO.util.Dom,r=YAHOO.util.Event,i=ORCHESTRAL.util.Locale;ORCHESTRAL.util.DateFormat=function(e){this._format=e};var s=ORCHESTRAL.util.DateFormat;s.prototype={format:function(e){if(e===null)return"";var t=this._format,n=[],r=function(e){return n[n.length]=e,"~"+(n.length-1)+"~"};t=t.replace(/'([^']+)'/g,function(e){return r(e.slice(1,-1))}),t=t.replace("''","'"),t=t.replace(/y{4,}/g,e.getFullYear()),t=t.replace(/y{1,3}/g,this._pad(e.getFullYear()%100)),t=t.replace(/M{4,}/g,r(i.get("util.date.months.long")[e.getMonth()])),t=t.replace(/M{3}/g,r(i.get("util.date.months.short")[e.getMonth()])),t=t.replace(/M{2}/g,this._pad(e.getMonth()+1)),t=t.replace(/M/g,e.getMonth()+1),t=t.replace(/d{2,}/g,this._pad(e.getDate())),t=t.replace(/d/g,e.getDate()),t=t.replace(/E{4,}/g,r(i.get("util.date.day.long")[e.getDay()])),t=t.replace(/E{1,3}/g,r(i.get("util.date.day.short")[e.getDay()])),t=t.replace(/a+/g,r(i.get("util.date."+(e.getHours()<12?"am":"pm")))),t=t.replace(/H{2,}/g,this._pad(e.getHours())),t=t.replace(/H/g,e.getHours()),t=t.replace(/h{2,}/g,this._pad(this._halfDay(e.getHours()))),t=t.replace(/h/g,this._halfDay(e.getHours())),t=t.replace(/m{2,}/g,this._pad(e.getMinutes())),t=t.replace(/m/g,e.getMinutes()),t=t.replace(/s{2,}/g,this._pad(e.getSeconds())),t=t.replace(/s/g,e.getSeconds());for(var s=0;s<n.length;s++)t=t.replace(new RegExp("~"+s+"~","g"),n[s]);return t},_pad:function(e){return e+="",(e.length==1?"0":"")+e},_halfDay:function(e){return(e+11)%12+1}},s.ISO_8601_DATE=new s("yyyy-MM-dd"),s.ISO_8601_DATE.parse=function(e){var t=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);return t===null?null:new Date(+t[1],+t[2]-1,+t[3])},s.ISO_8601_TIME=new s("HH:mm:ss"),s.ISO_8601_TIME.parse=function(e){var t=e.match(/^(\d{2}):(\d{2}):(\d{2})$/);return t===null?null:new Date(0,0,0,+t[1],+t[2],+t[3])},s.ISO_8601_DATE_TIME=new s("yyyy-MM-dd'T'HH:mm:ss"),s.ISO_8601_DATE_TIME.parse=function(e){var t=e.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})$/);return t===null?null:new Date(+t[1],+t[2]-1,+t[3],+t[4],+t[5],+t[6])},s.SHORT_DATE=new s(i.get("widget.datetime.short.date.format")),s.SHORT_TIME=new s(i.get("widget.datetime.short.time.format")),s.SHORT_DATE_TIME=new s(i.get("widget.datetime.short.datetime.format")),s.MEDIUM_DATE=new s(i.get("widget.datetime.medium.date.format")),s.MEDIUM_TIME=new s(i.get("widget.datetime.medium.time.format")),s.MEDIUM_DATE_TIME=new s(i.get("widget.datetime.medium.datetime.format")),s.LONG_DATE=new s(i.get("widget.datetime.long.date.format")),s.LONG_TIME=new s(i.get("widget.datetime.long.time.format")),s.LONG_DATE_TIME=new s(i.get("widget.datetime.long.datetime.format"));var o=function(e,t){this.year=e,this.month=t};o._YEAR_DISPLAY_FORMAT=new s(i.get("widget.datetime.medium.year.format")),o._YEAR_MONTH_DISPLAY_FORMAT=new s(i.get("widget.datetime.medium.yearmonth.format")),o.parse=function(e){var t=e.match(/^(\d{4})-(\d{2})$/);return t!==null?new o(+t[1],+t[2]):(t=e.match(/^(\d{4})$/),t!==null?new o(+t[1]):null)},o.prototype={formatDisplay:function(){return this._formatDate(o._YEAR_DISPLAY_FORMAT,o._YEAR_MONTH_DISPLAY_FORMAT)},formatISO:function(){return this._formatDate(new s("yyyy"),new s("yyyy-MM"))},_formatDate:function(e,t){return this.month?t.format(new Date(this.year,this.month-1,1)):e.format(new Date(this.year,0,1))}};var u=function(e){this.value=e};YAHOO.namespace("ORCHESTRAL.widget"),ORCHESTRAL.widget.Date=function(e){return e=n.get(e),n.addClass(e,"OrchestralDate"),new ORCHESTRAL.widget.DateTime(e)},ORCHESTRAL.widget.PartialDate=function(e){return e=n.get(e),n.addClass(e,"OrchestralPartialDate"),new ORCHESTRAL.widget.DateTime(e)},ORCHESTRAL.widget.Time=function(e){return e=n.get(e),n.addClass(e,"OrchestralTime"),new ORCHESTRAL.widget.DateTime(e)},ORCHESTRAL.widget.DateRange=function(e,t){this._from=new ORCHESTRAL.widget.Date(e),this._to=new ORCHESTRAL.widget.Date(t),this._from.setMax(n.get(t).value),this._to.setMin(n.get(e).value),this._from.subscribe("dateChanged",function(e){this._to.setMin(e.value)},this,!0),this._to.subscribe("dateChanged",function(e){this._from.setMax(e.value)},this,!0)},ORCHESTRAL.widget.DateRange.prototype={_from:null,_to:null,isValid:function(){return this._from.isValid()&&this._to.isValid()},addClass:function(e){this._from.addClass(e),this._to.addClass(e)},removeClass:function(e){this._from.removeClass(e),this._to.removeClass(e)},setAttribute:function(e,t){this._from.setAttribute(e,t),this._to.setAttribute(e,t)},removeAttribute:function(e){this._from.removeAttribute(e),this._to.removeAttribute(e)}},ORCHESTRAL.widget.DateTime=function(t){var s=ORCHESTRAL.util.Registry;if(s.get("ORCHESTRAL.widget.DateTime",t))return s.get("ORCHESTRAL.widget.DateTime",t);this._initialised=!1,this._hiddenInput=n.get(t),this._lastSeenHiddenInputValue=null,this._dateInput=null,this._timeInput=null,this._date=null,this._time=null,this.dateTimeChangedEvent=this.createEvent("dateTimeChanged"),this.timeChangedEvent=this.createEvent("timeChanged"),this.dateChangedEvent=this.createEvent("dateChanged"),this._min=null,this._max=null,this._isPartialDateInput=n.hasClass(this._hiddenInput,"OrchestralPartialDate"),this._isDateInput=n.hasClass(this._hiddenInput,"OrchestralDate")||this._isPartialDateInput,this._isTimeInput=n.hasClass(this._hiddenInput,"OrchestralTime"),!this._isDateInput&&!this._isTimeInput&&n.addClass(this._hiddenInput,"OrchestralDateTime"),this._isDateTimeInput=n.hasClass(this._hiddenInput,"OrchestralDateTime");var o=document.createElement("nobr"),u=this._hiddenInput.nextSibling;u?this._hiddenInput.parentNode.insertBefore(o,u):this._hiddenInput.parentNode.appendChild(o);var a=this._hiddenInput.getAttribute("aria-label"),f=function(e,t){a&&(this._isDateTimeInput?e.setAttribute("aria-label",i.get(t,a)):e.setAttribute("aria-label",a))};if(this._isDateInput||this._isDateTimeInput){this._dateInput=document.createElement("input"
),this._dateInput.setAttribute("type","text"),this._dateInput.setAttribute("size","11"),this._dateInput.className="medium",f.call(this,this._dateInput,"cow.datetime.label.screenReader.date"),o.appendChild(this._dateInput);var l=document.createElement("a");l.setAttribute("href","#"),l.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;",l.tabIndex=-1,o.appendChild(l),n.addClass(l,"OrchestralDatePicker"),r.on(l,"click",function(t,s){if(!n.hasClass(l,"disabled")){var o=n.getViewportHeight(),u=n.getViewportWidth(),a=n.get("OrchestralCalendar"),f=ORCHESTRAL.widget.DateTime._createCalendar(a,s.control);a.style.visibility="hidden",a.style.display="block";var c,h=n.getY(s.input),p=s.input.offsetHeight;h+p+a.offsetHeight-n.getDocumentScrollTop()<o?c=h+p:a.offsetHeight<h-n.getDocumentScrollTop()?c=h-a.offsetHeight:c=-1;var d,v=n.getX(s.input),m=n.getX(this),g=this.offsetWidth;v+a.offsetWidth-n.getDocumentScrollLeft()<u?d=v:a.offsetWidth<m-n.getDocumentScrollLeft()+g?d=m+g-a.offsetWidth:a.offsetWidth<u?d=u-a.offsetWidth:d=-1;var y=function(e){s.input.value=ORCHESTRAL.widget.DateTime._DATE_DISPLAY_FORMAT.format(e),s.control._handleUserDateUpdate(),s.input.select()};if(d!=-1&&c!=-1){f.selectEvent.subscribe(function(){a.style.visibility="hidden",y(f.getSelectedDates().pop())});var b=n.getAncestorBy(this,function(e){if(n.hasClass(e,"yui-panel"))return!1;var t=n.getStyle(e,"z-index");return t!==0&&t!="auto"});a.style.zIndex=b?n.getStyle(b,"z-index"):0,a.style.visibility="visible",n.setXY(a,[d,c])}else{f.cfg.setProperty("title",!1),f.cfg.setProperty("close",!1);var w,E=a.offsetHeight,S=a.offsetWidth,x=ORCHESTRAL.COMMON_WEB_CONTEXT+"/datetime/assets/calendar.html";f.cfg.setProperty("title",!0),f.cfg.setProperty("close",!0);for(var T=0;T<document.styleSheets.length;T++){var N=document.styleSheets[T];if(!N.disabled&&N.href&&(N.href.indexOf("assets/skins/hive")!=-1||N.href.indexOf("assets/skins/orchestral")!=-1)){x+="?skin="+function(){var e=N.href.split("/");return e[e.length-2]}();break}}a.style.display="none",ORCHESTRAL.widget.DateTime._popupConfig={activeControl:s.control,title:i.get("widget.datetime.calendar.title")},typeof Y!="undefined"&&Y.YUI2&&(window.ORCHESTRAL_DATETIME_POPUP_CONFIG=ORCHESTRAL.widget.DateTime._popupConfig);var C=function(){var t=0,n=0,r,i;return e.isUndefined(window.screenTop)?(t=screenY+(outerHeight-E)/2,n=screenX+(outerWidth-S)/2):window.top.document?(r=window.top.document,i=r.compatMode!="CSS1Compat"?r.body:r.documentElement,t=window.top.screenTop+(i.clientHeight-E)/2,n=window.top.screenLeft+(i.clientWidth-S)/2):(t=0,n=0),{top:t,left:n}}(),k=new Window(x,y,S,E,"Calendar",C);k.open(),r.on(window,"unload",k.close,null,k)}}r.stopEvent(t)},{input:this._dateInput,control:this}),r.on(this._dateInput,"blur",function(e){this._handleUserDateUpdate()},this,!0),(new YAHOO.util.KeyListener(this._dateInput,{keys:YAHOO.util.KeyListener.KEY.ENTER},{fn:function(e){this._handleUserDateUpdate()},scope:this,correctScope:!0})).enable()}o.childNodes.length>0&&o.appendChild(document.createTextNode(" "));if(this._isTimeInput||this._isDateTimeInput){this._timeInput=document.createElement("input"),this._timeInput.setAttribute("type","text"),this._timeInput.setAttribute("size","6"),this._timeInput.className="small",f.call(this,this._timeInput,"cow.datetime.label.screenReader.time");var c=document.createElement("span");c.className="orchestral-time-indicator",c.tabindex="-1",c.appendChild(document.createTextNode(" ")),this._isDateTimeInput&&(this._timeInput.className="small"),o.appendChild(this._timeInput),o.appendChild(c),r.on(this._timeInput,"blur",function(e){this._handleUserTimeUpdate()},this,!0),(new YAHOO.util.KeyListener(this._timeInput,{keys:YAHOO.util.KeyListener.KEY.ENTER},{fn:function(e){this._handleUserTimeUpdate()},scope:this,correctScope:!0})).enable()}this.setMin(this._hiddenInput.getAttribute("min")),this.setMax(this._hiddenInput.getAttribute("max")),this._updateView(),this._lastSeenHiddenInputValue=this._hiddenInput.value,this._dateInput&&(this._dateInput.defaultValue=this._dateInput.value),this._timeInput&&(this._timeInput.defaultValue=this._timeInput.value);var h=this;setInterval(function(){h._updateView()},ORCHESTRAL.widget.DateTime._POLLING_INTERVAL),this._hiddenInput.tabIndex=-1,r.on(this._hiddenInput,"focus",function(e){try{(this._isTimeInput?this._timeInput:this._dateInput).focus()}catch(t){}},this,!0),this._initialised=!0,s.put("ORCHESTRAL.widget.DateTime",this._hiddenInput,this)},ORCHESTRAL.widget.DateTime._enhanceMarkup=function(){if(window.ORCHESTRAL_DATETIME_MARKUP_ENHANCED||ORCHESTRAL.widget.DateTime._markupEnhanced)return;ORCHESTRAL.widget.DateTime._markupEnhanced=!0,typeof Y!="undefined"&&Y.YUI2&&(window.ORCHESTRAL_DATETIME_MARKUP_ENHANCED=ORCHESTRAL.widget.DateTime._markupEnhanced);var e=["OrchestralDate","OrchestralPartialDate","OrchestralTime","OrchestralDateTime"];for(var t=0;t<e.length;t++){var i=n.getElementsByClassName(e[t],"input");for(var s=0;s<i.length;s++)new ORCHESTRAL.widget.DateTime(i[s])}var o=document.createElement("div");o.id="OrchestralCalendar",o.style.display="none",o.style.position="absolute",document.body.appendChild(o);var u=function(e){o.style.display="none"};(new YAHOO.util.KeyListener(document,{keys:YAHOO.util.KeyListener.KEY.ESCAPE},{fn:u,scope:this,correctScope:!0})).enable(),r.on(document,"click",function(e){var t=r.getTarget(e);t!=o&&!n.isAncestor(o,t)&&u()})},ORCHESTRAL.widget.DateTime.get=function(e){return ORCHESTRAL.widget.DateTime._enhanceMarkup(),ORCHESTRAL.util.Registry.get("ORCHESTRAL.widget.DateTime",n.get(e))},ORCHESTRAL.widget.DateTime._createCalendar=function(e,u){var a=null,f=new YAHOO.widget.Calendar(e,{close:!0,title:i.get("widget.datetime.calendar.title"),LOCALE_MONTHS:"long",LOCALE_WEEKDAYS:"medium",MONTHS_SHORT:i.get("util.date.months.short"),MONTHS_LONG:i.get("util.date.months.long"),MULTI_SELECT:!1,START_WEEKDAY:i.get("widget.datetime.calendar.startDayOfWeek"),WEEKDAYS_MEDIUM:ORCHESTRAL.widget.DateTime._CALENDAR_WEEKDAYS});try{a=s.ISO_8601_DATE
.parse(u._hiddenInput.value.substr(0,10)),!a&&u._isPartialDateInput&&(a=o.parse(u._hiddenInput.value))}catch(l){}return a instanceof o?(f.setMonth(a.month?a.month-1:0),f.setYear(a.year)):(a instanceof Date?f.select(a):(a=new Date,u._min&&t.before(a,u._min)&&(a=u._min),u._max&&t.after(a,u._max)&&(a=u._max)),f.setMonth(a.getMonth()),f.setYear(a.getFullYear())),f.cfg.setProperty("mindate",u._min?new Date(u._min):null),f.cfg.setProperty("maxdate",u._max?new Date(u._max):null),f.renderEvent.subscribe(function(e,t,i){r.on("calmonth","change",function(e){i.setMonth(+n.get("calmonth").value),i.render()},i),r.on("calyear","change",function(e){i.setYear(+n.get("calyear").value),i.render()},i),r.on("headernavleft","click",function(e){r.preventDefault(e),setTimeout(function(){i.previousMonth(),n.get("headernavleft").focus()},0)},i,!0),r.on("headernavright","click",function(e){r.preventDefault(e),setTimeout(function(){i.nextMonth(),n.get("headernavright").focus()},0)},i,!0)},f),f.buildMonthLabel=function(){var e=this.Locale.LOCALE_MONTHS,t=this.cfg.getProperty("pagedate"),n=this.cfg.getProperty("mindate"),r=this.cfg.getProperty("maxdate"),i=Math.min(n===null?(new Date).getFullYear()-100:n.getFullYear(),t.getFullYear()),s=Math.max(r===null?(new Date).getFullYear()+2:r.getFullYear(),t.getFullYear()),o='<a href="#" id="headernavleft">&nbsp;</a>';o+='<select id="calmonth">';for(var u=0;u<e.length;u++)o+='<option value="'+u+'"'+(t.getMonth()==u?' selected="selected"':"")+">"+e[u]+"</option>";o+='</select><select id="calyear">';for(var a=s;a>=i;a--)o+='<option value="'+a+'"'+(a==t.getFullYear()?' selected="selected"':"")+">"+a+"</option>";return o+="</select>",o+='<a href="#" id="headernavright">&nbsp;</a>',o},f.render(),n.getElementsByClassName("calheader","div",f.oDomContainer,function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];n.nodeType==3&&n.parentNode.removeChild(n)}}),f},ORCHESTRAL.widget.DateTime._updateErrorStyling=function(e){n[n.hasClass(e,"OrchestralDateTimeRangeError")||n.hasClass(e,"OrchestralDateTimeInvalidValueError")?"addClass":"removeClass"](e,"ohp-date-time-invalid-error")},ORCHESTRAL.widget.DateTime._popupConfig=null,ORCHESTRAL.widget.DateTime._CALENDAR_WEEKDAYS=function(){return i.get("cow.datetime.label.calendar.dayColumnHeaders")}(),ORCHESTRAL.widget.DateTime._DATE_TIME_DISPLAY_FORMAT=s.MEDIUM_DATE_TIME,ORCHESTRAL.widget.DateTime._DATE_DISPLAY_FORMAT=s.MEDIUM_DATE,ORCHESTRAL.widget.DateTime._TIME_DISPLAY_FORMAT=s.MEDIUM_TIME,ORCHESTRAL.widget.DateTime._POLLING_INTERVAL=500,ORCHESTRAL.widget.DateTime.prototype={_DISPLAY_FORMAT_ENDS_WITH_YEAR:function(){var t=e.trim(ORCHESTRAL.widget.DateTime._DATE_DISPLAY_FORMAT._format);return t.charAt(t.length-1).toLowerCase()=="y"}(),_DAYS_FIRST:i.get("widget.datetime.display.daysBeforeMonths"),setMin:function(e){e&&!this._isPartialDateInput?this._isDateInput||this._isDateTimeInput&&e.length==10?this._min=s.ISO_8601_DATE.parse(e):this._isTimeInput?this._min=s.ISO_8601_TIME.parse(e):this._min=s.ISO_8601_DATE_TIME.parse(e):this._min=null,this._updateTooltip(),this._validateRanges()},setMax:function(e){e&&!this._isPartialDateInput?this._isDateInput?this._max=s.ISO_8601_DATE.parse(e):this._isTimeInput?this._max=s.ISO_8601_TIME.parse(e):this._max=s.ISO_8601_DATE_TIME.parse(e+(e.length==10?"T23:59:59":"")):this._max=null,this._updateTooltip(),this._validateRanges()},isValid:function(){var e=this._timeInput&&n.hasClass(this._timeInput,"OrchestralDateTimeInvalidValueError")||this._timeInput&&n.hasClass(this._timeInput,"OrchestralDateTimeRangeError")||n.hasClass(this._dateInput,"OrchestralDateTimeInvalidValueError")||n.hasClass(this._dateInput,"OrchestralDateTimeRangeError");return!e},addClass:function(e){this._dateInput&&n.addClass(this._dateInput,e),this._timeInput&&n.addClass(this._timeInput,e)},removeClass:function(e){this._dateInput&&n.removeClass(this._dateInput,e),this._timeInput&&n.removeClass(this._timeInput,e)},setAttribute:function(e,t){var r=e==="disabled"?!0:!1;this._dateInput&&(this._dateInput.setAttribute(e,t),r&&n.addClass(this._dateInput.nextSibling,"disabled")),this._timeInput&&(this._timeInput.setAttribute(e,t),r&&n.addClass(this._timeInput.nextSibling,"disabled"))},removeAttribute:function(e){var t=e==="disabled"?!0:!1;this._dateInput&&(this._dateInput.removeAttribute(e),t&&n.removeClass(this._dateInput.nextSibling,"disabled")),this._timeInput&&(this._timeInput.removeAttribute(e),t&&n.removeClass(this._timeInput.nextSibling,"disabled"))},setValue:function(e){e=e||"",this._lastSeenHiddenInputValue=e?"":"force_update",this._hiddenInput.value=e,this._updateView()},_handleUserDateUpdate:function(){this._dateInput.value=e.trim(this._dateInput.value);var t=this._parseDate(this._dateInput.value);!t&&this._isPartialDateInput&&(t=this._parsePartialDate(this._dateInput.value)),t||(t=this._dateInput.value==""?null:new u(this._dateInput.value)),this._updateDate(t),this._isDateTimeInput&&(this._date instanceof Date&&this._timeInput.value==""&&(this._min&&this._getDate(this._date).getTime()==this._getDate(this._min).getTime()?this._timeInput.value=this._min.getHours()+":"+this._min.getMinutes():this._timeInput.value="00:00"),this._handleUserTimeUpdate())},_updateDate:function(e,t){var r=this._date;this._date=e,n[e instanceof u?"addClass":"removeClass"](this._dateInput,"OrchestralDateTimeInvalidValueError"),ORCHESTRAL.widget.DateTime._updateErrorStyling(this._dateInput);var i;return e instanceof Date?(this._dateInput.value=ORCHESTRAL.widget.DateTime._DATE_DISPLAY_FORMAT.format(e),i=!(r instanceof Date)||r.getTime()!=e.getTime()):e instanceof o?(this._dateInput.value=e.formatDisplay(),i=!(r instanceof o)||r.year!=e.year||r.month!=e.month):e instanceof u?(this._dateInput.value=e.value,i=!(r instanceof u)||r.value!=e.value):(this._dateInput.value="",i=r!==null),this._validateRanges(),this._updateHiddenInput(),i&&this._initialised&&(this.dateChangedEvent.fire(this._hiddenInput),t||this.dateTimeChangedEvent.fire(this._hiddenInput)),i},_handleUserTimeUpdate
:function(){this._timeInput.value=e.trim(this._timeInput.value);var t=this._parseTime(this._timeInput.value);t||(t=this._timeInput.value==""?null:new u(this._timeInput.value)),this._updateTime(t)},_updateTime:function(e,t){var r=this._time;this._time=e,n[e instanceof u?"addClass":"removeClass"](this._timeInput,"OrchestralDateTimeInvalidValueError"),ORCHESTRAL.widget.DateTime._updateErrorStyling(this._timeInput),this._isDateTimeInput&&this._date===null&&(n[e!==null?"addClass":"removeClass"](this._dateInput,"OrchestralDateTimeInvalidValueError"),ORCHESTRAL.widget.DateTime._updateErrorStyling(this._dateInput));var i;return e instanceof Date?(this._timeInput.value=ORCHESTRAL.widget.DateTime._TIME_DISPLAY_FORMAT.format(e),i=!(r instanceof Date)||r.getTime()!=e.getTime()):e instanceof u?(this._timeInput.value=e.value,i=!(r instanceof u)||r.value!=e.value):(this._timeInput.value="",i=r!==null),this._validateRanges(),this._updateHiddenInput(),i&&this._initialised&&(this.timeChangedEvent.fire(this._hiddenInput),t||this.dateTimeChangedEvent.fire(this._hiddenInput)),i},_parseDate:function(e){if(/^\d{8}$/.test(e))return this._validateDate(e.substr(this._DAYS_FIRST?0:2,2),e.substr(this._DAYS_FIRST?2:0,2),e.substr(4));var t=this._splitDateParts(e);return t.length!=3?null:isNaN(t[0])?this._validateDate(t[1],t[0],t[2]):+t[0]>31?this._validateDate(t[2],t[1],t[0]):+t[2]>31||this._DISPLAY_FORMAT_ENDS_WITH_YEAR?+t[0]>12||isNaN(t[1])?this._validateDate(t[0],t[1],t[2]):+t[1]>12?this._validateDate(t[1],t[0],t[2]):this._validateDate(t[this._DAYS_FIRST?0:1],t[this._DAYS_FIRST?1:0],t[2]):this._validateDate(t[2],t[1],t[0])},_parsePartialDate:function(e){var t=this._splitDateParts(e);return t.length==1?this._validatePartialDate(t[0]):t.length==2?+t[0]>12||isNaN(t[1])?this._validatePartialDate(t[0],t[1]):+t[1]>12||isNaN(t[0])?this._validatePartialDate(t[1],t[0]):this._validatePartialDate(t[this._DISPLAY_FORMAT_ENDS_WITH_YEAR?1:0],t[this._DISPLAY_FORMAT_ENDS_WITH_YEAR?0:1]):null},_splitDateParts:function(e){var t=e.split(/\.?\s*[\-\.\/ ]\s*/),n=[];for(var r=0;r<t.length;r++)t[r]!=""&&n.push(t[r]);return n},_validateDate:function(e,t,n){if(!e||!t||!n)return null;e=+e;if(isNaN(e)||e===0||e>31)return null;n=this._normaliseYear(n),t=this._normaliseMonth(t);if(!n||!t)return null;var r=new Date(n,t-1,e);return r.getMonth()!=t-1?null:r},_validatePartialDate:function(e,t){e=this._normaliseYear(e);if(!e)return null;if(t){t=this._normaliseMonth(t);if(!t)return null}return t?new o(e,t):new o(e)},_normaliseYear:function(e){var t=e.length;return t!=2&&t!=4?null:(e=+e,isNaN(e)?null:(t==2&&(e+=e>50?1900:2e3),e))},_normaliseMonth:function(e){return isNaN(e)&&(e=this._getMonthFromText(e)),e=+e,e<1||e>12?null:e},_getMonthFromText:function(){var e=function(e){var t=i.get("util.date.normalizedChars");for(var n in t)t.hasOwnProperty(n)&&(e=e.replace(n,t[n]));return e.replace(/\.$/,"").toLowerCase()};return function(t){t=e(t);var n,r,s=i.get("util.date.months.long"),o=i.get("util.date.months.short");for(r=0;r<s.length;r++)if(t==e(s[r]))return r+1;for(r=0;r<o.length;r++){var u=e(o[r]);if(t==u)return r+1;if(u.indexOf(t)===0||u=="juin"&&t=="jun"||u=="juil"&&t=="jul"){if(!!n)return null;n=r+1}}return n?n:null}}(),_parseTime:function(e){var t=e.match(/^(.*\d)\s*(\D*)$/);if(!t)return null;var n,r,i,s=t[1],o=t[2]||"";if(/^\d{1,2}$/.test(s))n=s,r=0,i=0;else if(/^\d{3}$/.test(s))n=s.charAt(0),r=s.substr(1),i=0;else if(/^\d{4}$/.test(s))n=s.substr(0,2),r=s.substr(2),i=0;else if(/^\d{6}$/.test(s))n=s.substr(0,2),r=s.substr(2,2),i=s.substr(4);else if(/^\d/.test(s)){t=s.match(/^(\d{1,2}) ?h ?(\d{2})$/);if(t&&o=="")n=t[1],r=t[2],i=0;else{var u=s.match(/^(\d+) *[:|\.]? *(\d+) *[:|\.]? *(\d+)?$/);if(!u)return null;n=u[1],r=u[2],i=u[3]||0}}n=+n,r=+r,i=+i;if(isNaN(n)||isNaN(r)||isNaN(i))return null;if(o!=""){if(!/^[ap]\.?m?\.?$/i.test(o))return null;o=o.charAt(0).toLowerCase()}var a=o==""?24:12;return n<0||n>a||r<0||r>59||i<0||i>59?null:n==a&&n==24?r===0&&i===0?new Date(0,0,0,23,59,59):null:(o=="a"&&n==12&&(n-=12),o=="p"&&n!=12&&(n+=12),new Date(0,0,0,n,r,i))},_updateHiddenInput:function(){this._isDateInput&&this._date instanceof u?this._hiddenInput.value=this._dateInput.value:this._isTimeInput&&this._time instanceof u?this._hiddenInput.value=this._timeInput.value:this._date instanceof u||this._time instanceof u?this._hiddenInput.value=e.trim(this._dateInput.value+" "+this._timeInput.value):this._date&&this._time?this._hiddenInput.value=s.ISO_8601_DATE_TIME.format(this._getDateTime(this._date,this._time)):this._date?this._hiddenInput.value=this._date instanceof o?this._date.formatISO():s.ISO_8601_DATE.format(this._date):this._time?this._hiddenInput.value=s.ISO_8601_TIME.format(this._time):this._hiddenInput.value="",this._lastSeenHiddenInputValue=this._hiddenInput.value},_updateTooltip:function(){var t=function(){return""};this._min&&this._max?t=function(t){return e.substitute(i.get("widget.datetime.minmax.hint"),[t.format(this._min),t.format(this._max)])}:this._min?t=function(t){return e.substitute(i.get("widget.datetime.min.hint"),[t.format(this._min)])}:this._max&&(t=function(t){return e.substitute(i.get("widget.datetime.max.hint"),[t.format(this._max)])});if(this._isDateInput)this._dateInput.title=t.call(this,ORCHESTRAL.widget.DateTime._DATE_DISPLAY_FORMAT);else if(this._isTimeInput)this._timeInput.title=t.call(this,ORCHESTRAL.widget.DateTime._TIME_DISPLAY_FORMAT);else if(this._isDateTimeInput){var n=t.call(this,ORCHESTRAL.widget.DateTime._DATE_TIME_DISPLAY_FORMAT);this._dateInput.title=n,this._timeInput.title=n}},_validateRanges:function(){var e=function(e,t){return e.getFullYear()==t.getFullYear()&&e.getMonth()==t.getMonth()&&e.getDate()==t.getDate()},r=function(){n.addClass(this._dateInput,"OrchestralDateTimeRangeError"),n.addClass(this._dateInput,"ohp-date-time-invalid-error")},i=function(){n.addClass(this._timeInput,"OrchestralDateTimeRangeError"),n.addClass(this._timeInput,"ohp-date-time-invalid-error")};return function(){if(this._isPartialDateInput
)return;this._isDateInput||(n.removeClass(this._timeInput,"OrchestralDateTimeRangeError"),ORCHESTRAL.widget.DateTime._updateErrorStyling(this._timeInput)),this._isTimeInput||(n.removeClass(this._dateInput,"OrchestralDateTimeRangeError"),ORCHESTRAL.widget.DateTime._updateErrorStyling(this._dateInput,"error"));var s=this._date instanceof Date,o=this._time instanceof Date;if((this._isDateInput||this._isDateTimeInput)&&!s||this._isTimeInput&&!o)return;var u;this._isTimeInput?u=this._getDateTime(new Date(0,0,0),this._time):this._isDateInput?u=this._getDate(this._date):u=this._getDateTime(this._date,o?this._time:new Date(0,0,0,23,59,59)),this._max&&t.after(u,this._max)&&(this._isDateInput?r.apply(this):this._isTimeInput?i.apply(this):e(u,this._max)?o&&i.apply(this):r.apply(this)),this._isDateTimeInput&&!o&&(u=this._getDate(this._date)),this._min&&t.before(u,this._min)&&(this._isDateInput?t.before(t.clearTime(u),t.clearTime(this._min))&&r.apply(this):this._isTimeInput?i.apply(this):e(u,this._min)?o&&i.apply(this):r.apply(this))}}(),_getDate:function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0)},_getDateTime:function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes(),t.getSeconds())},_updateView:function(){var e=this._hiddenInput.value,t=null,n=null,r,i,a;if(e==this._lastSeenHiddenInputValue)return;this._isDateInput?(t=s.ISO_8601_DATE.parse(e),!t&&this._isPartialDateInput&&(t=o.parse(e)),t||(t=e==""?null:new u(e)),this._updateDate(t)):this._isTimeInput?(n=s.ISO_8601_TIME.parse(e),n||(n=e==""?null:new u(e)),this._updateTime(n)):(e&&(r=s.ISO_8601_DATE_TIME.parse(e),r?(t=new Date(r.getFullYear(),r.getMonth(),r.getDate()),n=new Date(0,0,0,r.getHours(),r.getMinutes(),r.getSeconds())):(t=s.ISO_8601_DATE.parse(e),t||(n=s.ISO_8601_TIME.parse(e),n||(t=new u(e))))),i=this._updateDate(t,!0),a=this._updateTime(n,!0),(i||a)&&this._initialised&&this.dateTimeChangedEvent.fire(this._hiddenInput))}},e.augment(ORCHESTRAL.widget.Date,YAHOO.util.EventProvider),e.augment(ORCHESTRAL.widget.PartialDate,YAHOO.util.EventProvider),e.augment(ORCHESTRAL.widget.Time,YAHOO.util.EventProvider),e.augment(ORCHESTRAL.widget.DateTime,YAHOO.util.EventProvider),r.onDOMReady(function(){ORCHESTRAL.widget.DateTime._enhanceMarkup()})}(),YAHOO.register("orchestral-datetime",ORCHESTRAL.widget.DateTime,{version:"7.9",build:"0"});
