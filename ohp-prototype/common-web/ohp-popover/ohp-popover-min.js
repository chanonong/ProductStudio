/*
 * Copyright (c) Orchestral Developments Ltd (2001 - 2014).
 *
 * This document is copyright. Except for the purpose of fair reviewing, no part
 * of this publication may be reproduced or transmitted in any form or by any
 * means, electronic or mechanical, including photocopying, recording, or any
 * information storage and retrieval system, without permission in writing from
 * the publisher. Infringers of copyright render themselves liable for
 * prosecution.
 */
YUI.add("ohp-popover",function(e,t){function n(){}function a(t){var n=[];o()&&n.push(i);if(t.asWindow){var r={fn:e.Plugin.OHP.PopoverWindow};n.push(r)}if(t.isEditable){var s={fn:e.Plugin.OHP.Editable};n.push(s)}t.constrain=!1,t.preventOverlap=!0,t.plugins===null&&n.length>0&&(t.plugins=n),u.add(this),a.superclass.constructor.apply(this,arguments),e.Do.after(this._afterShow,this,"show"),e.Do.before(this._beforeShow,this,"show"),e.Do.after(this._afterRender,this,"render"),e.Do.before(this._beforeHide,this,"hide"),e.Do.after(this._afterHide,this,"hide")}n.top="top",n.bottom="bottom",n.left="left",n.right="right";var r=function(e,t){e=e||[],t=t||[];var n=e.length,r=t.length,i;if(n!==r)return!1;for(i=0;i<n;i++)if(e[i]!==t)return!1;return!0},i={fn:e.Plugin.WidgetAnim,cfg:{duration:.25}},s=40,o=function(){var t=!(e.UA.ie===6||e.UA.ie===7||e.UA.ie===8||e.UA.ipad>0);return t},u=function(){var t=[];return{count:function(){return t.length},add:function(e){t.push(e)},hide:function(n){var r;for(r=t.length-1;r>=0;r--)n||t[r].unplug(e.Plugin.WidgetAnim),t[r].hide(),t[r].set("visible",!1),n||o()&&t[r].plug(i)}}}();a.hideAll=function(e){var t=!0;e&&e.animate!==null&&(t=e.animate),u.hide(t)};var f=!1;a.suspend=function(){f=!0},a.resume=function(){f=!1},a.isSuspended=function(){return f};var l,c=function(e){var t=e.get("offsetTop"),n=e.get("offsetLeft"),r=e.get("offsetWidth"),i=e.get("offsetHeight"),s=e;while(s.get("offsetParent"))s=s.get("offsetParent"),t+=s.get("offsetTop"),n+=s.get("offsetLeft");return{top:t,left:n,width:r,height:i}},h=function(t){var n=e.Node.getDOMNode(t),r=e.DOM.inViewportRegion(e.Node.getDOMNode(t),!0);return r},p=function(e){var t=c(e),n=e.get("winHeight"),r=e.get("winWidth"),i=t.top>=n,s=t.left>=r,o=t.top+t.height>=n,u=t.left+t.width>=r;return isNodeTopGreaterThanNodeHeight=t.top>t.height,{offRight:u,offBottom:o,offTop:i,offLeft:s,spaceAbove:isNodeTopGreaterThanNodeHeight}};a.NAME="ohp-popover",a.ATTRS={hideDelay:{value:750,readOnly:!0},showDelay:{value:500,readOnly:!0},triggerNode:{validator:function(t){return e.Lang.isString(t)||e.instanceOf(t,e.Node)},setter:function(t){return e.Lang.isString(t)?e.Node.one(t):t}},triggerXY:{validator:function(t){return e.Lang.isArray(t)},setter:function(t){var n=e.Node.one("#"+this.get("id")+"-xy-triger");return n||(n=e.Node.create('<a href="#" id="'+this.get("id")+'-xy-triger" class="x-y-trigger" style="display:block;height: px;width:1px;position:absolute;"></a>'),e.one("body").append(n)),n.setXY(t),this.set("triggerNode","a#"+this.get("id")+"-xy-triger"),t}},trigger:{validator:function(t){if(e.Lang.isString(t)||e.instanceOf(t,e.Node)||e.instanceOf(t,e.NodeList))return!0;if(e.Lang.isObject(t)){if(e.Object.hasKey(t,"handler")&&!e.Lang.isFunction(t.handler))return!1;if(e.Object.hasKey(t,"delegate")){if(!e.Object.hasKey(t.delegate,"el")||!e.Object.hasKey(t.delegate,"filter"))return!1;if(!e.Lang.isString(t.delegate.el)&&!e.instanceOf(t.delegate.el,e.Node))return!1;if(!e.Lang.isString(t.delegate.filter))return!1}return!0}},setter:function(t){var n=t;return e.Lang.isString(t)?{node:e.one(t)}:(e.Lang.isObject(t)&&(n=e.merge({handler:function(e){var t=this.get("srcNode");t&&this.set("bodyContent",t.getContent())}},t)),n)}},onShow:{validator:function(t){return e.Lang.isFunction(t)}},onHide:{validator:function(t){return e.Lang.isFunction(t)}},alignment:{value:n.bottom},triggerEvent:{value:!1,setter:function(e){return e}},content:{value:" ",setter:function(t){var n,r,i,s;return t===" "?t:(this.get("contentBox").hasClass("loading")&&this.get("contentBox").removeClass("loading"),s=e.Node.create(t),s===null?"":s.hasChildNodes()?(n=s.one(".yui3-widget-hd"),r=s.one(".yui3-widget-bd"),i=s.one(".yui3-widget-ft"),n!==null?this.setStdModContent(e.WidgetStdMod.HEADER,n.get("innerHTML")):this.getStdModNode(e.WidgetStdMod.HEADER)&&this.getStdModNode(e.WidgetStdMod.HEADER).destroy(),r!==null?this.setStdModContent(e.WidgetStdMod.BODY,r.get("innerHTML")):this.setStdModContent(e.WidgetStdMod.BODY,s.get("innerHTML")),i!==null?this.setStdModContent(e.WidgetStdMod.FOOTER,i.get("innerHTML")):this.getStdModNode(e.WidgetStdMod.FOOTER)&&this.getStdModNode(e.WidgetStdMod.FOOTER).destroy(),r?r.get("innerHTML"):"No Content Set"):(this.setStdModContent(e.WidgetStdMod.BODY,t),t))}},asWindow:{value:!1},isEditable:{value:!1},hasBeak:{value:!0},maxHeight:{value:null},maxWidth:{value:null},zIndex:{value:2},visible:{value:!1},render:{value:!0}},e.extend(a,e.Overlay,{BOUNDING_TEMPLATE:'<div class="yui3-popover yui-popover"><div class="beak-item"></div></div>',CONTENT_TEMPLATE:'<div class="yui3-popover-content yui-popover-content"></div>',initializer:function(){this.set("constrain",!1),this.set("preventOverlap",!0);var e=this.get("content")},bindUI:function(){var t=this.get("trigger"),n=t?t.node||this.get("triggerNode"):this.get("triggerNode"),r,i;t&&t.delegate?(this._bindDelegates(t),t.handler&&(r=e.bind(t.handler,this),i=function(e){r(this.get("triggerNode"))},this.subscribe("show",i))):n&&this.bindToNode(n),this.on(["mouseleave","mouseout"],function(e){this.delayedHide()}),this.on(["mouseenter","mouseover"],function(e){l&&l.cancel()}),this.on("show",function(e){this.publish("show",{broadcast:!0})}),this.on("hide",function(e){this.publish("hide",{broadcast:!0})});if(Modernizr.touch){var s=this.getStdModNode(e.WidgetStdMod.HEADER);s&&s.on("touchend",function(e){this.hide()},this),e.Event.defineOutside("touchstart"),this.get("contentBox").on("touchstartoutside",function(e){this.get("visible")&&e.target!==this.get("triggerNode")&&this.hide()},this)}e.on("windowresize",function(e){this.get("visible")===!0&&this.show()},this,null)},renderUI:function(){this._wrapNode(this.get("contentBox"))},_bindDelegates:function(t){var n=t.delegate.el,r=t.delegate.filter,i=this.get("triggerEvent"),s,o,u,a,f;u=function(e){s=e.target,o=this.get("triggerNode"),this.setAttrs({triggerNode:s}),o===s?this.toggle(e):this.show(),e.preventDefault()},a=function(e){s=e.
target,this.setAttrs({triggerNode:s}),l&&l.cancel(),this.delayedShow(),e.preventDefault()},f=function(e){s=e.target,this.setAttrs({triggerNode:s}),this.delayedHide(),e.preventDefault()},i!=="click"&&e.delegate(["mouseover","mouseenter"],a,n,r,this),e.delegate("click",u,n,r,this),e.delegate(["mouseout","mouseleave"],f,n,r,this)},bindToNode:function(t,n){t.addClass("evented");var r=this.get("triggerEvent"),i,s;i=function(){this.delayedShow({triggerNode:t})},s=function(e){this.setAttrs({triggerNode:t}),this.toggle(e)};if(n){var o=function(){var r=e.bind(n,this);r(t)};this.subscribe("show",o)}r==="hover"&&!e.UA.ipad?t.on({mouseenter:e.bind(i,this),mouseleave:e.bind(this.delayedHide,this)}):r==="click"?t.on({click:e.bind(s,this),mouseleave:e.bind(this.delayedHide,this)}):t.on({mouseenter:e.bind(i,this),mouseleave:e.bind(this.delayedHide,this),click:e.bind(s,this)})},hide:function(){if(a.isSuspended())return;l&&l.cancel(),a.superclass.hide.apply(this,arguments),this.fire("hide")},show:function(t){if(a.isSuspended())return;u.hide(!0);if(l)try{l.cancel()}catch(n){}t&&this.setAttrs(t);try{this.getStdModNode(e.WidgetStdMod.BODY)||this.get("contentBox").addClass("loading")}catch(r){}a.superclass.show.apply(this,arguments),this.fire("show",!0)},toggle:function(e){this.get("visible")?this.hide():this.show(),e&&e.preventDefault()},set:function(e,t){if(a.isSuspended())return;a.superclass.set.apply(this,arguments)},_afterShow:function(){var e=this._alignThis();this.get("hasBeak")&&this._applyBeak(e),this.fire("showcomplete",!0)},_alignThis:function(){var e=this.get("triggerNode"),t=this.get("alignment"),r=!1;return t===n.bottom?r=this._alignForBottom(e):t===n.right?this._alignForRight(e):t===n.left?this._alignForLeft(e):t===n.top?this._alignForTop(e):r=this._alignForBottom(e),h(this.get("boundingBox"))||this.fire("notinview"),r},_beforeShow:function(){return f?new e.Do.Prevent:!0},_beforeHide:function(){return f?new e.Do.Prevent:!0},_afterHide:function(){var t=this.getStdModNode(e.WidgetStdMod.BODY);t&&t.setStyle("overflow","auto")},_afterRender:function(){this.register()},clear:function(){this.setStdModContent(e.WidgetStdMod.BODY,null),this.setStdModContent(e.WidgetStdMod.HEADER,null),this.setStdModContent(e.WidgetStdMod.FOOTER,null)},_applyBeak:function(e){var t=this.get("triggerNode"),r=c(t),i={trigger:t,triggerLocation:r,isInversed:e};this.get("alignment")===n.right?this._beakForRight(i):this.get("alignment")===n.left?this._beakForLeft(i):this.get("alignment")===n.top?this._beakForTop(i):this.get("alignment")===n.bottom?this._beakForBottom(i):this._beakForBottom(i)},_wrapNode:function(t){var n=e.Node.create('<div class="level-1"></div>'),r=e.Node.create('<div class="level-2"></div>'),i=e.Node.create('<div class="level-3"></div>');i.insert(t),r.insert(i),n.insert(r);var s=this.get("boundingBox");s.insert(n)},register:function(){u.add(this)},lock:function(){a.suspend()},unlock:function(){a.resume()},delayedShow:function(t){if(a.isSuspended())return;var n=this.get("showDelay");l&&l.cancel();var r=this.get("trigger");(!r||!r.delegate)&&u.hide(!0),l=e.later(n,this,this.show,t,!1)},delayedHide:function(){if(a.isSuspended())return;var t=this.get("hideDelay");l&&l.cancel(),l=e.later(t,this,u.hide,!0,!1)},_alignForBottom:function(t){var n;this.set("align",{node:t,points:[e.WidgetPositionAlign.TC,e.WidgetPositionAlign.BC]});var r=e.DOM.intersect(t,this.get("boundingBox"));this.get("boundingBox").getStyle("left").indexOf("-")===0&&this.get("boundingBox").setStyle("left","-33px");if(!h(this.get("boundingBox"))){n=p(this.get("boundingBox"));if(n.offBottom&&n.spaceAbove)return this.set("align",{node:t,points:[e.WidgetPositionAlign.BC,e.WidgetPositionAlign.TC]}),this.get("boundingBox").getStyle("left").indexOf("-")===0&&this.get("boundingBox").setStyle("left","-33px"),!0;if(n.offRight){var i=0,o;while(!h(this.get("boundingBox"))){if(i>s)break;o=this.get("xy"),this.move(o[0]-5,o[1]),i++}}}return!1},_alignForRight:function(t){this.set("align",{node:t,points:[e.WidgetPositionAlign.TL,e.WidgetPositionAlign.TR]});var n=this.get("xy");this.move(n[0],n[1]-35);if(!h(this.get("contentBox"))){var r=0;while(!h(this.get("contentBox"))){if(r>s)break;n=this.get("xy"),this.move(n[0],n[1]-5),r++}}},_alignForTop:function(t){this.set("align",{node:t,points:[e.WidgetPositionAlign.BC,e.WidgetPositionAlign.TC]});var r=this.get("xy");this.move(r[0]+5,r[1]);if(!h(this.get("boundingBox"))){if(p(this.get("boundingBox")).offBottom)return this.set("align",{node:t,points:[e.WidgetPositionAlign.TC,e.WidgetPositionAlign.BC]}),this.get("boundingBox").getStyle("left").indexOf("-")===0&&this.get("boundingBox").setStyle("left","-33px"),this.set("alignment",n.bottom),!0;if(p(this.get("boundingBox")).offRight){var i=0;while(!h(this.get("boundingBox"))){if(i>s)break;r=this.get("xy"),this.move(r[0]-5,r[1]),i++}}}return!0},_alignForLeft:function(t){this.set("align",{node:t,points:[e.WidgetPositionAlign.TR,e.WidgetPositionAlign.TL]});var n=this.get("xy");this.move(n[0]-12,n[1]-38);if(!h(this.get("contentBox"))){var r=0;while(!h(this.get("contentBox"))){if(r>s)break;n=this.get("xy"),this.move(n[0],n[1]-5),r++}}},_beakForTop:function(e){var t=e.trigger.get("offsetWidth"),n=this.get("boundingBox"),r=c(n),i=r.left-(e.triggerLocation.left+t/2),s=n.get("offsetWidth")/2,o;i<0&&(i=parseInt(i,10)*-1),i<25&&(i=25),i>n.get("offsetWidth")&&(i=s),o=n.one(".beak-item"),o.set("className",""),o.addClass("beak-item"),o.addClass("beak-over"),o.setStyle("left",i-10+"px")},_beakForBottom:function(e){var t=e.trigger.get("offsetWidth"),n=this.get("boundingBox"),r=c(n),i=r.left-(e.triggerLocation.left+t/2),s=n.get("offsetWidth")/2,o;i<0&&(i=parseInt(i,10)*-1),i<25&&(i=25),i>n.get("offsetWidth")&&(i=s),o=n.one(".beak-item"),o.set("className",""),o.addClass("beak-item"),o.addClass(e.isInversed?"beak-over":"beak"),o.setStyle("left",i-10+"px")},_beakForLeft:function(e){var t=this.get("boundingBox"),n=c(t),r=n.top-e.triggerLocation.top,i=4,s;this.get("triggerXY")&&(i=8),r<0&&(r=parseInt
(r,10)*-1),r<25&&(r=26),r>t.get("height")&&(r=t.get("height")-15),s=t.one(".beak-item"),s.set("className",""),s.addClass("beak-item"),s.addClass("beak-left"),s.setStyle("top",r-i+"px"),s.setStyle("right","-22px")},_beakForRight:function(e){var t=this.get("boundingBox"),n=c(t),r=n.top-e.triggerLocation.top,i=4,s;this.get("triggerXY")&&(i=8),r<0&&(r=parseInt(r,10)*-1),r<25&&(r=26),r>t.get("height")&&(r=t.get("height")-15),s=t.one(".beak-item"),s.set("className",""),s.addClass("beak-item"),s.addClass(e.isInversed?"beak-left":"beak-right"),s.setStyle("top",r-i+"px")},trigger:function(e,t){this.get("_activeTrigger")||this.set("_activeTrigger",e),this.get("_activeTrigger").get("id")!==e.get("id")&&l&&l.cancel(),this.set("triggerNode",e),this.set("alignment",t?"right":"bottom"),this.show()},triggerShow:function(e,t){this.set("triggerNode",e),this.set("alignment",t?"right":"bottom"),this.show()},triggerDelayedShow:function(t,n){var r=this.get("showDelay");l&&l.cancel(),l=e.later(r,this,this.triggerShow,[t,n],!1)},triggerHide:function(){this.delayedHide()},triggerOver:function(){l&&l.cancel()},showWithDetails:function(e){e&&this.setAttrs(e),this.show()}}),e.namespace("ORCHESTRAL").Popover=a,e.namespace("OHP").Popover=a,e.namespace("OHP").PopoverAlignment=n},"7.9.0",{requires:["ohp-editable","overlay","event-touch","event-hover","event-mouseenter","widget-anim","yui-later","event-outside"]});
