/*
 * Copyright (c) Orchestral Developments Ltd (2001 - 2014).
 *
 * This document is copyright. Except for the purpose of fair reviewing, no part
 * of this publication may be reproduced or transmitted in any form or by any
 * means, electronic or mechanical, including photocopying, recording, or any
 * information storage and retrieval system, without permission in writing from
 * the publisher. Infringers of copyright render themselves liable for
 * prosecution.
 */
YUI.add("ohp-scrollpane",function(e,t){"use strict";function Z(e){return Number(e.replace(/px/,"").replace(/pt/,""))}function et(e,t){return Z(e.getComputedStyle(t))}var n,r,i,s=e.WidgetStdMod,o=e.Lang,u=e.OHP.Locale,a=e.OHP.OhpClassNameManager.getClassName,f="left",l="right",c="ScrollPane",h=c.toLowerCase(),p=25,d=12,v=a(h,"vertical"),m=a(h,"horizontal"),g=a(h,"autohide"),y=a(h,"align","left"),b=a(h,"align","right"),w=a(h,"container"),E=a(h,"content","area"),S=a(h,"hover"),x=a(h,"drag"),T=a(h,"indicator"),N=a(h,"indicator","bottom"),C=a(h,"indicator","top"),k=a(h,"overflow","bottom"),L=a(h,"overflow","horizontal"),A=a(h,"overflow","top"),O=a(h,"overflow","vertical"),M=a(h),_=a(h,"bar"),D=a(h,"vertical","bar"),P=a(h,"vertical","track"),H=a(h,"vertical","bar","drag"),B=a(h,"horizontal","bar"),j=a(h,"horizontal","track"),F=a(h,"horizontal","bar","drag"),I=a(h,"vertical","bar","arrow","up"),q=a(h,"vertical","bar","arrow","down"),R=a(h,"vertical","bar","arrow"),U=a(h,"horizontal","bar","arrow","left"),z=a(h,"horizontal","bar","arrow","right"),W=a(h,"horizontal","bar","arrow"),X=a(h,"arrow"),V='<div class="'+E+'"></div>',$='<div class="'+w+'"></div>',J='<a href="#" class="'+T+' {className}">'+'<span class="ohp-screen-reader-only">{screenReaderText}</span>'+"<span></span>"+"</a>",K='<div class="'+D+" "+_+'">'+'<a href="#" class="'+R+" "+I+" "+X+'">'+'<span class="ohp-screen-reader-only">{upScreenReaderText}</span>'+"</a>"+'<div class="'+P+'">'+'<div class="'+H+'" style="top: 0;"></div>'+"</div>"+'<a href="#" class="'+R+" "+q+" "+X+'">'+'<span class="ohp-screen-reader-only">{downScreenReaderText}</span>'+"</a>"+"</div>",Q='<div class="'+B+" "+_+'">'+'<a href="#" class="'+W+" "+U+" "+X+'">'+'<span class="ohp-screen-reader-only">{leftScreenReaderText}</span>'+"</a>"+'<div class="'+j+'">'+'<div class="'+F+'" style="left: 0;"></div>'+"</div>"+'<a href="#" class="'+W+" "+z+" "+X+'">'+'<span class="ohp-screen-reader-only">{rightScreenReaderText}</span>'+"</a>"+"</div>",G={vertical:!0,horizontal:!1,sizeType:"height",scrollSizeType:"scrollHeight",posStyleType:"top",scrollPosType:"scrollTop",scrollbarClass:D,trackClass:P,thumbClass:H,arrowClass:R,overflowClass:O},Y={vertical:!1,horizontal:!0,sizeType:"width",scrollSizeType:"scrollWidth",posStyleType:"left",scrollPosType:"scrollLeft",scrollbarClass:B,trackClass:j,thumbClass:F,arrowClass:W,overflowClass:L};r=function(){var t=!1;return function(){t||(e.on("ScrollPane|mousewheel",function(t){var n=e.Widget.getByNode(t.target),r,i;n&&n.get("vertical")&&(r=n.get("boundingBox"),i=n.get("contentArea"),t.wheelDelta>0?n._scroll(r,i,G,!1):t.wheelDelta<0&&n._scroll(r,i,G,!0),t.preventDefault())}),t=!0)}}(),n=e.Base.create(c,e.Widget,[s],{initializer:function(){this.publish("scroll"),this._enableThumbSync=!0},renderUI:function(){var e=this.get("boundingBox"),t=this.get("contentBox"),n,r=e.get("parentNode"),i=et(r,"height"),s=et(r,"width");t.removeClass(M),e.addClass(this.getClassName("loading")),this._renderBody(t),this.set("height",i),this.set("width",s),n=this.get("contentArea"),this._storeCurrentScrollSize("scrollHeight",n.get("scrollHeight")),this._storeCurrentScrollSize("scrollWidth",n.get("scrollWidth")),this._storeCurrentScrollPosition("scrollTop",n.get("scrollTop")),this._storeCurrentScrollPosition("scrollLeft",n.get("scrollLeft")),this.get("showVerticalIndicators")&&this._renderVerticalIndicators(e),this.get("vertical")&&(t.addClass(v),this._renderVerticalScrollBar()),this.get("horizontal")&&(t.addClass(m),this._renderHorizontalScrollBar()),this.get("showArrows")||e.all("."+X).setStyle("display","none"),t.addClass(this.get("align")===f?y:b),this.get("autoHide")&&t.addClass(g)},_renderBody:function(t){var n,r,i;r=t.one("."+w),r||(r=e.Node.create($),r.append(t.get("children"))),n=this.getStdModNode(s.BODY);if(!n||!n.contains(r))i=e.Node.create(V),this.setStdModContent(s.BODY,i),n=this.getStdModNode(s.BODY),i.append(r);n.addClass(this.getClassName("body")),r.setStyle("width","auto"),r.setStyle("height","auto")},_renderVerticalIndicators:function(e){this._renderIndicator(e,s.HEADER,C,u.get("widget.scrollPane.action.screenReader.scrollUp")),this._renderIndicator(e,s.FOOTER,N,u.get("widget.scrollPane.action.screenReader.scrollDown"))},_renderIndicator:function(t,n,r,i){var s,o;s=e.Node.create(e.substitute(J,{className:r,screenReaderText:i})),o=t.one("."+r),o&&o.replace(s),this.setStdModContent(n,s)},_renderVerticalScrollBar:function(){var t=e.substitute(K,{upScreenReaderText:u.get("widget.scrollPane.action.screenReader.scrollUp"),downScreenReaderText:u.get("widget.scrollPane.action.screenReader.scrollDown")});this.setStdModContent(s.BODY,t,s.AFTER)},_renderHorizontalScrollBar:function(){var t=e.substitute(Q,{leftScreenReaderText:u.get("widget.scrollPane.action.screenReader.scrollLeft"),rightScreenReaderText:u.get("widget.scrollPane.action.screenReader.scrollRight")});this.setStdModContent(s.BODY,t,s.AFTER)},bindUI:function(){var t=this.get("boundingBox"),n=this.get("contentBox"),i=this.get("contentArea"),s=this.get("vertical"),o=this.get("horizontal");this._bindScrollBarArrowEvents(t,i),this._bindThumbDrag(t,i,G),this._bindThumbDrag(t,i,Y),this.get("showVerticalIndicators")&&this._bindVerticalIndicatorEvents(t,i),t.on("mouseup",this._cancelScrollTimer,this),s&&r(),t.on("mouseenter",function(){n.addClass(S)}),t.on("mouseleave",function(){n.removeClass(S)}),i.on("scroll",function(){s&&this._updateIfBrowserScrollPositionChanged(t,i,G),o&&this._updateIfBrowserScrollPositionChanged(t,i,Y)},this),e.later(200,this,function(){this._updateDimensionsIfChanged(t,n,i)},null,!0)},_bindScrollBarArrowEvents:function(e,t){var n=e.one("."+I),r=e.one("."+q),i=e.one("."+U),s=e.one("."+z);n&&this._bindScrollButtonEvents(e,t,G,!1,n),r&&this._bindScrollButtonEvents(e,t,G,!0,r),i&&this._bindScrollButtonEvents(e,t,Y,!1,i),s&&this._bindScrollButtonEvents(e,t,Y,!0,s)},_bindThumbDrag:function(t,n,r){var i=this.get("contentBox"),s=t.one("."+r
.thumbClass),o,u;if(!s)return;o=t.one("."+r.trackClass),u=(new e.DD.Drag({node:s})).plug(e.Plugin.DDConstrained,{constrain:o,useShim:!1,stickX:r.horizontal,stickY:r.vertical}),u.on("start",function(){i.addClass(x),this._enableThumbSync=!1},this),u.on("end",function(){i.removeClass(x),this._enableThumbSync=!0},this),u.on("drag",function(){var e=r.sizeType,t=et(s,r.posStyleType),i=et(s,e),u=et(o,e),a=et(n,e),f,l,c;f=t/(u-i),l=this._getStoredCurrentScrollSize(r.scrollSizeType),c=Math.round(f*(l-a)),this._updateContentScrollPosition(n,r,c)},this)},_bindVerticalIndicatorEvents:function(e,t){this.on("scroll",function(){this._updateScrollIndicators(e,t)},this),this._bindScrollButtonEvents(e,t,G,!1,e.one("."+C)),this._bindScrollButtonEvents(e,t,G,!0,e.one("."+N))},_bindScrollButtonEvents:function(t,n,r,i,s){var o=function(){this._scroll(t,n,r,i)};s.on({click:e.bind(function(e){e.preventDefault(),o.call(this)},this),mousedown:e.bind(function(t){this._cancelScrollTimer(),this._scrollTimer=e.later(100,this,o,null,!0,n),s.focus(),t.preventDefault()},this)})},_cancelScrollTimer:function(){this._scrollTimer&&(this._scrollTimer.cancel(),this._scrollTimer=null)},_updateIfBrowserScrollPositionChanged:function(e,t,n){var r=n.scrollPosType,i=t.get(r),s=this._getStoredCurrentScrollPosition(r);i!==s&&(this._storeCurrentScrollPosition(r,i),this.fire("scroll"),this._syncThumbPosition(e,t,n))},_updateDimensionsIfChanged:function(e,t,n){var r=e.get("parentNode"),i=et(r,"height"),o=et(r,"width"),u=n.get("scrollHeight"),a=n.get("scrollWidth"),f=!1,l=!1,c=!1,h,p,d,v,m;if(o===0||i===0||a===0||u===0)return;p=et(e,"height"),d=et(e,"width"),p!==i&&(this.set("height",i),f=!0),d!==o&&(this.set("width",o),f=!0),h=e.get("offsetHeight");if(h===0)return;this._syncDimensions&&(t.setStyle("height","100%"),this.fillHeight(this.getStdModNode(s.BODY)),this._syncDimensions=!1),this.get("vertical")&&(v=this._getStoredCurrentScrollSize("height"),u!==v&&(this._storeCurrentScrollSize("scrollHeight",u),l=!0),(f||l)&&this._updateScrollBarsAndIndicators(e,n,G)),this.get("horizontal")&&(m=this._getStoredCurrentScrollSize("width"),a!==m&&(this._storeCurrentScrollSize("scrollWidth",a),c=!0),(f||c)&&this._updateScrollBarsAndIndicators(e,n,Y))},_getStoredCurrentScrollSize:function(e){return this["_"+e]},_storeCurrentScrollSize:function(e,t){this["_"+e]=t},_getStoredCurrentScrollPosition:function(e){return this["_"+e]},_storeCurrentScrollPosition:function(e,t){this["_"+e]=t},syncUI:function(){var e=this.get("boundingBox"),t=this.get("contentArea"),n=t.get("scrollHeight");if(n<=0){this._syncDimensions=!0;return}this.get("horizontal")&&this._updateScrollBarsAndIndicators(e,t,Y),this.get("vertical")&&this._updateScrollBarsAndIndicators(e,t,G)},_updateScrollBarsAndIndicators:function(e,t,n){this._updateScrollBar(e,t,n),n.vertical&&this.get("showVerticalIndicators")&&this._updateScrollIndicators(e,t)},_updateScrollBar:function(e,t,n){var r=n.sizeType,i=this._getStoredCurrentScrollSize(n.scrollSizeType),s=et(t,r),o=i>s,u="."+n.arrowClass,a,f,l,c,h,p;e[o?"addClass":"removeClass"](n.overflowClass);if(!o)return;a=e.one("."+n.scrollbarClass),f=e.one("."+n.trackClass),l=e.one("."+n.thumbClass),c=et(a,r),this.get("showArrows")&&a.all(u).each(function(e){c-=et(e,r)}),f.setStyle(r,c+"px"),p=i/s,h=Math.max(d,Math.round(c/p)),l.setStyle(r,h),this._syncThumbPosition(e,t,n,f,l)},_updateScrollIndicators:function(e,t){var n=this._isOverflowTop(t),r=this._isOverflowBottom(t);e[r?"addClass":"removeClass"](k),e[n?"addClass":"removeClass"](A)},_isOverflowTop:function(e){var t=e.get("scrollTop");return t>0},_isOverflowBottom:function(e){var t=e.get("scrollTop"),n=this._getMaxScrollPosition(e,G);return t<n},_getMaxScrollPosition:function(e,t){var n=et(e,t.sizeType),r=this._getStoredCurrentScrollSize(t.scrollSizeType),i=r-n;return i},_updateContentScrollPosition:function(e,t,n){var r=t.scrollPosType,i=this._getMaxScrollPosition(e,t);n<=0&&(n=0,this._cancelScrollTimer()),n>=i&&(n=i,this._cancelScrollTimer()),this._storeCurrentScrollPosition(r,n),e.set(r,n),this.fire("scroll")},_syncThumbPosition:function(e,t,n,r,i){if(!this._enableThumbSync)return;var s=n.sizeType,o=this._getStoredCurrentScrollSize(n.scrollSizeType),u=et(t,s),a,f,l,c,h,p,d;if(o<=u)return;r=r||e.one("."+n.trackClass),i=i||e.one("."+n.thumbClass),a=t.get(n.scrollPosType),f=o-u,l=a/f,c=et(i,s),h=et(r,s),p=h-c,d=Math.round(l*p),i.setStyle(n.posStyleType,d)},_scroll:function(e,t,n,r){var i=r?p:-p,s;s=t.get(n.scrollPosType)+i,this._updateContentScrollPosition(t,n,s),this._syncThumbPosition(e,t,n)}},{CSS_PREFIX:a(h),ATTRS:{vertical:{validator:o.isBoolean,value:!0,writeOnce:"initOnly"},horizontal:{validator:o.isBoolean,value:!1,writeOnce:"initOnly"},showArrows:{validator:o.isBoolean,value:!1,writeOnce:"initOnly"},autoHide:{validator:o.isBoolean,value:!1,writeOnce:"initOnly"},align:{value:l,validator:function(e){if(!o.isValue(e)||!o.isString(e))return!1;var t=e.toLowerCase();return t===f||t===l},writeOnce:"initOnly"},showVerticalIndicators:{validator:o.isBoolean,value:!1,writeOnce:"initOnly"},contentArea:{getter:function(){var e=this.getStdModNode(s.BODY).one("."+E);return e},readOnly:!0}},HTML_PARSER:{align:function(e){return e.hasClass(y)?f:l},autoHide:function(e){return e.hasClass(g)}}}),e.namespace("OHP").ScrollPane=n,i=function(){function t(t){function n(t){var n;return t=e.one(t),t?(n=t.ancestor("."+M,!0),n&&n.one("."+w)):!1}return t=t||{},function(r){n(r)||new e.OHP.ScrollPane(e.merge({srcNode:r,render:!0},t))}}e.all(".ohp-scrollpane-vertical").each(t()),e.all(".ohp-scrollpane-horizontal").each(t({horizontal:!0,vertical:!1})),e.all("."+M).each(t({horizontal:!0}))},n.scrollInit=i},"7.9.0",{requires:["ohp-locale-translations","node","ohp-locale-base","ohp-ohp-class-name-manager","event","widget-stdmod","substitute","widget","dd-constrain","yui-later"]});
