/*
 * Copyright (c) Orchestral Developments Ltd (2001 - 2014).
 *
 * This document is copyright. Except for the purpose of fair reviewing, no part
 * of this publication may be reproduced or transmitted in any form or by any
 * means, electronic or mechanical, including photocopying, recording, or any
 * information storage and retrieval system, without permission in writing from
 * the publisher. Infringers of copyright render themselves liable for
 * prosecution.
 */
YUI.add("ohp-autocomplete-force-selection-plugin",function(e,t){"use strict";function o(){o.superclass.constructor.apply(this,arguments)}var n=e.OHP.Locale,r=e.OHP.OhpClassNameManager.getClassName,i={container:r("ac","fs","container"),displayText:r("ac","fs","text"),changeLink:r("ac","fs","link")},s=e.Handlebars.compile('<span class="'+i.container+'">'+'<span class="'+i.displayText+'"></span>'+'&nbsp;<a href="#" class="'+i.changeLink+'">'+n.get("widget.autocomplete.change")+"</a>"+"</span>");o.NS="fs",o.NAME="ForceSelection",e.extend(o,e.Plugin.Base,{initializer:function(e){this._input=e.host,this._displayContainer=this._setupDisplayContainer(),this._eventHandles=[this._input.ac.after("select",function(e){this._selectedItem=e.result,this._displaySelectedItem()},this),this._input.on("blur",function(){!this._selectedItem||this._input.get("value")!==this._selectedItem.text?(this._input.set("value",""),this._selectedItem=null):this._displaySelectedItem()},this)]},destructor:function(){e.Array.invoke(this._eventHandles,"detach"),this._displayContainer.purge(!0),this._displayContainer.remove(),this._displayContainer=null},_setupDisplayContainer:function(){var t=this._input,n=t.getDOMNode().offsetHeight,r=e.Node.create(s()),o=r.one("."+i.changeLink);return t.insert(r,"after"),r.setStyle("minHeight",n+"px"),r.hide(),o.on("click",function(e){e.preventDefault(),e.stopPropagation(),r.hide(),t.show(),t.set("value",this._selectedItem.text),t.ac.sendRequest(this._selectedItem.text),t.select(),t.focus()},this),r},_displaySelectedItem:function(){var e=this._displayContainer;e.getAttribute("hidden")!=="true"&&(this._input.hide(),e.one("."+i.displayText).setHTML(this._selectedItem.display),e.show(),e.setStyle("display","inline-block"),e.one("."+i.changeLink).focus())}}),e.namespace("OHP.Plugin").ForceSelection=o},"7.9.0",{requires:["base","handlebars","plugin","ohp-locale-translations","ohp-locale-base","ohp-ohp-class-name-manager"]});
