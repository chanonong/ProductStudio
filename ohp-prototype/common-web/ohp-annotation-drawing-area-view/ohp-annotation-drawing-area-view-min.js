/*
 * Copyright (c) Orchestral Developments Ltd (2001 - 2014).
 *
 * This document is copyright. Except for the purpose of fair reviewing, no part
 * of this publication may be reproduced or transmitted in any form or by any
 * means, electronic or mechanical, including photocopying, recording, or any
 * information storage and retrieval system, without permission in writing from
 * the publisher. Infringers of copyright render themselves liable for
 * prosecution.
 */
YUI.add("ohp-annotation-drawing-area-view",function(e,t){"use strict";var n=e.OHP.Annotation.DrawingView,r=e.OHP.Annotation.Layer,i=e.OHP.AnnotationClassNameManager.getClassName,s;s=e.Base.create("ohp-annotation-drawing-area-view",e.View,[],{events:{".ohp-annotation-drawing-area":{mousedown:"_mouseDownHandler",mousemove:"_mouseMoveHandler",mouseup:"_mouseUpHandler"}},_mouseDown:!1,initializer:function(){var t=this.get("annotationModel"),r=t.get("toolModelList"),i=t.get("drawingModelList");r.on("activeToolModelChange",this._activeToolModelChangeHandler,this),r.set("activeToolModel",r.item(0)),i.after("add",function(e){var t=new n({drawingModel:e.model,drawingLayer:this.get("drawingLayer"),selectionLayer:this.get("selectionLayer")});t.render()},this),i.after("*:highlightedChange",this._highlightedDrawingChangeHandler,this),e.on("mouseupoutside",this._mouseUpHandler,".ohp-annotation-drawing-area",this),e.on("mouseleave",this._mouseUpHandler,"body",this),e.on("selectstart",function(e){e.preventDefault()},".ohp-annotation-drawing-area")},_activeToolModelChangeHandler:function(e){var t=this.get("container"),n=e.prevVal,r,s;n&&(r=n.get("tool"),t.removeClass(i("active","tool",r.get("name"))),t.removeClass(i("active","tool","type",r.get("type")))),s=e.newVal.get("tool"),t.addClass(i("active","tool",s.get("name"))),t.addClass(i("active","tool","type",s.get("type")))},_highlightedDrawingChangeHandler:function(e){var t=this.get("container"),n=i("selectable"),r=this.get("annotationModel").get("drawingModelList");e.newVal?t.addClass(n):r.get("highlightedCount")===0&&t.removeClass(n)},render:function(){var e=this.get("container"),t,n,r;return e.addClass(i("drawing","area")),e.setStyle("width",this.get("width")),e.setStyle("height",this.get("height")),t=this.get("drawingLayer"),n=this.get("selectionLayer"),r=this.get("toolLayer"),t.set("container",e),n.set("container",e),r.set("container",e),t.render(),n.render(),r.render(),this},_getEventPoint:function(e){var t=this.get("drawingLayer").getXY(),n=e.pageX-t.x,r=e.pageY-t.y;return n<=0||n>=this.get("width")||r<=0||r>=this.get("height")?null:{x:n,y:r}},_getBodyElement:function(){return this._bodyEl||(this._bodyEl=this.get("container").ancestor("body")),this._bodyEl},_mouseDownHandler:function(e){var t;!this._mouseDown&&e.button===1&&(t=this._getEventPoint(e),t&&(this._mouseDown=!0,this.get("annotationModel").get("toolModelList").get("activeToolModel").get("tool").start(this.get("toolLayer"),t),this._getBodyElement().addClass(i("user-interaction","in-progress"))))},_mouseMoveHandler:function(e){var t=this._getEventPoint(e),n;t&&(n=this.get("annotationModel").get("toolModelList").get("activeToolModel").get("tool"),this._mouseDown?n.drag(t):n.move(t))},_mouseUpHandler:function(e){var t;this._mouseDown&&(t=this._getEventPoint(e),this._mouseDown=!1,this.get("annotationModel").get("toolModelList").get("activeToolModel").get("tool").end(t),this._getBodyElement().removeClass(i("user-interaction","in-progress")))}},{ATTRS:{annotationModel:{writeOnce:"initOnly"},width:{writeOnce:"initOnly"},height:{writeOnce:"initOnly"},drawingLayer:{readOnly:!0,valueFn:function(){return new r({width:this.get("width"),height:this.get("height")})}},selectionLayer:{readOnly:!0,valueFn:function(){return new r({width:this.get("width"),height:this.get("height"),stroke:{color:"#AEB2B6",weight:1,dashstyle:[3,3]}})}},toolLayer:{readOnly:!0,valueFn:function(){return new r({width:this.get("width"),height:this.get("height")})}}}}),e.namespace("OHP.Annotation").DrawingAreaView=s},"7.9.0",{requires:["ohp-annotation-drawing-view","node-core","ohp-annotation-class-name-manager","node-style","yui-base","base","view","ohp-annotation-layer","event-mouseenter","event-base","event-outside","node-base"]});
